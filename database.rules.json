
{
  "rules": {
    "rules_version": "2",
    "service": "cloud.firestore",
    "match": "/databases/{database}/documents",
    "// Helper functions": "function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }",
    "match": "/users/{userId}",
    "allow": "read: if isSignedIn(); write: if isUser(userId);",
    "match": "/users/{userId}/friends/{friendId}",
    "allow": "list: if isUser(userId); write: if isSignedIn() && (isUser(userId) || isUser(friendId)) && (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) || exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId))); delete: if isSignedIn() && (isUser(userId) || isUser(friendId));",
    "match": "/friendRequests/{requestId}",
    "allow": "read: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to); create: if isSignedIn() && request.auth.uid == request.resource.data.from && request.resource.data.status == 'pending' && request.resource.data.keys().hasAll(['from', 'to', 'status', 'createdAt']); delete: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);",
    "match": "/rooms/{roomId}",
    "allow": "read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;",
    "match": "/messages/{messageId}",
    "allow": "read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true; update, delete: if false;"
  }
}
