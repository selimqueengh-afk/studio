[debug] [2025-07-24T19:26:50.755Z] ----------------------------------------------------------------------
[debug] [2025-07-24T19:26:50.759Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-24T19:26:50.760Z] CLI Version:   14.10.1
[debug] [2025-07-24T19:26:50.761Z] Platform:      linux
[debug] [2025-07-24T19:26:50.761Z] Node Version:  v20.19.1
[debug] [2025-07-24T19:26:50.761Z] Time:          Thu Jul 24 2025 19:26:50 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-24T19:26:50.762Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-24T19:26:50.766Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-07-24T19:26:51.596Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-07-24T19:26:51.596Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-07-24T19:26:52.168Z] openjdk version "21.0.7" 2025-04-15

[debug] [2025-07-24T19:26:52.170Z] OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-24T19:26:52.228Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-24T19:26:52.272Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-24T19:26:52.279Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-24T19:26:52.307Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-24T19:26:52.308Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-24T19:26:52.308Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-24T19:26:55.467Z] Jul 24, 2025 7:26:55 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 7:26:55 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-24T19:26:55.538Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-24T19:26:55.543Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-24T19:26:55.629Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T19:28:45.815Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T19:28:45.815Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Allows authenticated users to read and write to the rooms and messages collections\n    match /rooms/{roomId} {\n      allow read, create: if request.auth != null;\n      allow update, delete: if request.auth.uid == resource.data.creatorId;\n\n      match /messages/{messageId} {\n        allow read, create: if request.auth != null;\n      }\n    }\n    \n    // Allows authenticated users to read the users collection, and create/update their own user document\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null && request.auth.uid == userId;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T19:28:45.855Z] Jul 24, 2025 7:28:45 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 7:28:45 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T19:28:46.466Z] Jul 24, 2025 7:28:46 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 7:28:46 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-24T19:28:48.417Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T19:28:48.417Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T19:41:38.144Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T19:41:38.144Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /rooms/{roomId} {\n      allow read, write: if request.auth != null;\n      match /messages/{messageId} {\n        allow read, write: if request.auth != null;\n      }\n    }\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null && request.auth.uid == userId;\n\n      match /friends/{friendId} {\n        allow read, write: if request.auth != null && request.auth.uid == userId;\n      }\n    }\n    match /friendRequests/{requestId} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T19:41:38.180Z] Jul 24, 2025 7:41:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 7:41:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T19:41:38.327Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T19:41:38.327Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T19:50:10.486Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T19:50:10.487Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth.uid == userId;\n\n      // A user can manage their own friends list.\n      // Another user can write to this list ONLY IF\n      // there is an accepted friend request between them.\n      match /friends/{friendId} {\n        allow read, write: if request.auth.uid == userId;\n        allow write: if request.auth != null && \n                       (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) || \n                        exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)));\n      }\n    }\n    \n    // Friend requests can be created by anyone authenticated,\n    // read by the recipient, and deleted by either party involved in the request.\n    match /friendRequests/{requestId} {\n      allow create: if request.auth != null && request.resource.data.from == request.auth.uid;\n      allow read, delete: if request.auth != null && (request.auth.uid == resource.data.to || request.auth.uid == resource.data.from);\n    }\n\n    // Rooms can be created by authenticated users.\n    // Users can only read/write messages in rooms they are participants of.\n    match /rooms/{roomId} {\n      allow read, write: if request.auth != null && request.auth.uid in resource.data.participants;\n      \n      match /messages/{messageId} {\n        allow read, create: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T19:50:10.507Z] Jul 24, 2025 7:50:10 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 7:50:10 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T19:50:10.675Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T19:50:10.677Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":15,"column":32,"currentOffset":556,"endOffset":565},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":15,"column":42,"currentOffset":566,"endOffset":566},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":15,"column":43,"currentOffset":567,"endOffset":567},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":15,"column":54,"currentOffset":578,"endOffset":587},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":15,"column":79,"currentOffset":603,"endOffset":603},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":15,"column":80,"currentOffset":604,"endOffset":604},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":15,"column":91,"currentOffset":615,"endOffset":616},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":16,"column":32,"currentOffset":662,"endOffset":671},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":16,"column":42,"currentOffset":672,"endOffset":672},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":16,"column":43,"currentOffset":673,"endOffset":673},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":16,"column":54,"currentOffset":684,"endOffset":693},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":16,"column":79,"currentOffset":709,"endOffset":709},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":16,"column":80,"currentOffset":710,"endOffset":710},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:15:32 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:15:42 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:15:43 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:15:54 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:15:79 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:15:80 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:15:91 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:16:32 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:16:42 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:16:43 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:16:54 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:16:79 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:16:80 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T19:53:20.315Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T19:53:20.316Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check for an existing friend request\n    function friendRequestExists(fromId, toId) {\n      return exists(/databases/$(database)/documents/friendRequests/$(fromId)_$(toId));\n    }\n\n    match /users/{userId} {\n      // Anyone can create their own user document\n      allow create: if request.auth.uid == userId;\n      // Anyone can read any user's profile data\n      allow read: if request.auth.uid != null;\n      // Users can only update their own profile data\n      allow update: if request.auth.uid == userId;\n      \n      match /friends/{friendId} {\n        // A user can only read their own friends list\n        allow read: if request.auth.uid == userId;\n        \n        // Allow creating/deleting a friend document if:\n        // 1. You are the user managing your own friend list (removing a friend)\n        // 2. You are accepting a friend request from the other user.\n        allow write: if (request.auth.uid == userId) || \n                       (request.auth.uid == friendId && friendRequestExists(userId, friendId));\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      // Users can read requests sent to them\n      allow read: if request.auth.uid == resource.data.to;\n      \n      // Users can create a request if they are the sender\n      allow create: if request.auth.uid == request.resource.data.from;\n      \n      // Users can delete a request if they are the recipient (accept/reject) or the sender (cancel)\n      allow delete: if request.auth.uid == resource.data.to || request.auth.uid == resource.data.from;\n    }\n    \n    match /rooms/{roomId} {\n      allow read, write: if request.auth.uid != null;\n      \n      match /messages/{messageId} {\n        allow read, write: if request.auth.uid != null;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T19:53:20.324Z] Jul 24, 2025 7:53:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 7:53:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T19:53:20.434Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T19:53:20.438Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":8,"column":21,"currentOffset":223,"endOffset":232},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":8,"column":31,"currentOffset":233,"endOffset":233},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":8,"column":32,"currentOffset":234,"endOffset":234},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":8,"column":43,"currentOffset":245,"endOffset":254},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":8,"column":68,"currentOffset":270,"endOffset":270},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":8,"column":69,"currentOffset":271,"endOffset":271},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":8,"column":78,"currentOffset":280,"endOffset":281},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":50,"column":1,"currentOffset":1864,"endOffset":1864},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:8:21 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:8:31 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:8:32 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:8:43 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:8:68 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:8:69 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:8:78 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:50:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:04:25.978Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:04:25.985Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check if a user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n\n    // Helper function to check if a user is the owner of a document\n    function isOwner(userId) {\n      return request.auth.uid == userId;\n    }\n\n    // USERS\n    match /users/{userId} {\n      // Anyone can read a user's profile\n      allow get: if isAuthenticated();\n\n      // Only the user themselves can create or update their own profile\n      allow create, update: if isAuthenticated() && isOwner(userId);\n\n      // FRIENDS subcollection\n      match /friends/{friendId} {\n        // A user can only read their own friends list\n        allow read: if isAuthenticated() && isOwner(userId);\n        \n        // Writing to friends list is handled by the acceptFriendRequest logic below\n        allow write: if false; \n      }\n    }\n    \n    // ROOMS (Existing rules - unchanged)\n    match /rooms/{roomId} {\n      allow read, write: if isAuthenticated();\n      match /messages/{messageId} {\n        allow read, write: if isAuthenticated();\n      }\n    }\n\n    // FRIEND REQUESTS\n    match /friendRequests/{requestId} {\n      // Allow read if the user is either the sender or the receiver of the request\n      allow get: if isAuthenticated() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n\n      // Allow creating a request if the sender is the authenticated user\n      // and the request ID format is correct (from_to)\n      allow create: if isAuthenticated() && isOwner(request.resource.data.from) && requestId == request.resource.data.from + '_' + request.resource.data.to;\n\n      // Allow deleting a request if the user is the receiver (accept/reject) or the sender (cancel)\n      allow delete: if isAuthenticated() && (isOwner(resource.data.to) || isOwner(resource.data.from));\n\n      // Friend requests cannot be updated\n      allow update: if false;\n    }\n\n    // TRANSACTIONAL RULES for accepting friend requests\n    // This allows the batch write in acceptFriendRequest to succeed\n    match /users/{userId}/friends/{friendId} {\n        // Allow a user to be added to another user's friend list ONLY IF\n        // there was a corresponding friend request that is being deleted in the same transaction.\n        allow create: if isAuthenticated() &&\n                      existsAfter(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) == false &&\n                      get(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)).data.to == userId;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:04:26.005Z] Jul 24, 2025 8:04:26 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:04:26 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:04:26.136Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:04:26.141Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":65,"column":35,"currentOffset":2454,"endOffset":2463},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":65,"column":45,"currentOffset":2464,"endOffset":2464},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":65,"column":46,"currentOffset":2465,"endOffset":2465},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":65,"column":57,"currentOffset":2476,"endOffset":2485},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":65,"column":82,"currentOffset":2501,"endOffset":2501},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":65,"column":83,"currentOffset":2502,"endOffset":2502},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":65,"column":94,"currentOffset":2513,"endOffset":2514},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":27,"currentOffset":2563,"endOffset":2572},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":37,"currentOffset":2573,"endOffset":2573},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":38,"currentOffset":2574,"endOffset":2574},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":49,"currentOffset":2585,"endOffset":2594},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":74,"currentOffset":2610,"endOffset":2610},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":75,"currentOffset":2611,"endOffset":2611},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:65:35 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:65:45 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:65:46 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:65:57 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:65:82 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:65:83 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:65:94 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:66:27 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:66:37 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:66:38 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:66:49 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:66:74 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:66:75 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:05:27.720Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:05:27.726Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n    \n    function requestExists(fromId, toId) {\n      return exists(/databases/$(database)/documents/friendRequests/$(fromId)_$(toId));\n    }\n\n    // Rules for 'users' collection\n    match /users/{userId} {\n      // Any signed-in user can read another user's profile\n      allow get: if isSignedIn();\n      // Only the user themselves can create or update their profile\n      allow write: if isUser(userId);\n\n      // Rules for 'friends' subcollection\n      match /friends/{friendId} {\n        // A user can only read their own friends list\n        allow read: if isUser(userId);\n        \n        // This is the key change for accepting requests:\n        // Allow creating a friend document if:\n        // 1. The user is accepting a request (userId == request.resource.data.to)\n        // 2. A valid friend request exists from the other party.\n        // This allows the batch write in acceptFriendRequest to succeed.\n        allow create: if (isUser(userId) && requestExists(friendId, userId)) || (isUser(friendId) && requestExists(userId, friendId));\n\n        // A user can only delete friends from their own list\n        allow delete: if isUser(userId) || isUser(friendId);\n      }\n    }\n\n    // Rules for 'friendRequests' collection\n    match /friendRequests/{requestId} {\n      // A user can read a request if they are the sender or receiver\n      allow read: if isSignedIn() && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n      \n      // A user can create a request if they are the sender\n      allow create: if isSignedIn() && request.resource.data.from == request.auth.uid;\n\n      // A user can delete a request if they are the sender (cancel) or receiver (accept/reject)\n      allow delete: if isSignedIn() && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n    }\n    \n    // Rules for 'rooms' collection\n    match /rooms/{roomId} {\n      allow read: if isSignedIn() && (resource.data.participants[request.auth.uid] == true || resource.data.participants.includes(request.auth.uid));\n      allow create: if isSignedIn();\n\n      match /messages/{messageId} {\n        allow read, write: if isSignedIn() && (get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true || get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.includes(request.auth.uid));\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:05:27.746Z] Jul 24, 2025 8:05:27 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:05:27 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:05:27.860Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:05:27.863Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":17,"column":21,"currentOffset":347,"endOffset":356},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":17,"column":31,"currentOffset":357,"endOffset":357},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":17,"column":32,"currentOffset":358,"endOffset":358},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":17,"column":43,"currentOffset":369,"endOffset":378},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":17,"column":68,"currentOffset":394,"endOffset":394},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":17,"column":69,"currentOffset":395,"endOffset":395},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":17,"column":78,"currentOffset":404,"endOffset":405},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":66,"column":1,"currentOffset":2684,"endOffset":2684},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:17:21 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:17:31 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:17:32 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:17:43 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:17:68 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:17:69 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:17:78 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:66:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:08:17.472Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:08:17.477Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read/write their own user document.\n    // They can only read other users' documents.\n    match /users/{userId} {\n      allow read, update, delete: if request.auth != null && request.auth.uid == userId;\n      allow create: if request.auth != null;\n      allow get: if request.auth != null;\n    }\n\n    // Users can read/write to their own friends subcollection\n    match /users/{userId}/friends/{friendId} {\n      allow read, delete: if request.auth != null && request.auth.uid == userId;\n      // Allow user to be added to another user's friend list ONLY if a corresponding friend request exists\n      allow create: if (request.auth != null && request.auth.uid == userId) || \n                      (request.auth != null && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)));\n    }\n    \n    // Friend Requests\n    match /friendRequests/{requestId} {\n      // A user can create a request if they are the sender\n      allow create: if request.auth != null && request.resource.data.from == request.auth.uid;\n      \n      // A user can read a request if they are the sender or receiver\n      allow get: if request.auth != null && (request.resource.data.from == request.auth.uid || request.resource.data.to == request.auth.uid);\n      \n      // A user can delete a request if they are the sender (cancel) or receiver (reject/accept)\n      allow delete: if request.auth != null && (get(/databases/$(database)/documents/friendRequests/$(requestId)).data.from == request.auth.uid || get(/databases/$(database)/documents/friendRequests/$(requestId)).data.to == request.auth.uid);\n    }\n\n    // Chat Rooms and Messages\n    match /rooms/{roomId} {\n      // Allow read/create if the user is a participant in a DM room\n      allow get, create: if request.auth != null && resource.data.isDirectMessage == true && request.auth.uid in resource.data.participants;\n      // Allow read for public rooms\n      allow get: if request.auth != null && resource.data.isDirectMessage != true;\n    }\n\n    match /rooms/{roomId}/messages/{messageId} {\n      allow read, create: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:08:17.527Z] Jul 24, 2025 8:08:17 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:08:17 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:08:17.677Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:08:17.685Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":20,"column":55,"currentOffset":839,"endOffset":848},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":65,"currentOffset":849,"endOffset":849},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":66,"currentOffset":850,"endOffset":850},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":77,"currentOffset":861,"endOffset":870},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":102,"currentOffset":886,"endOffset":886},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":103,"currentOffset":887,"endOffset":887},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":114,"currentOffset":898,"endOffset":899},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":114,"currentOffset":898,"endOffset":899},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:20:55 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:65 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:66 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:77 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:102 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:103 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:114 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:20:114 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:14:42.478Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:14:42.478Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Users can read anyone's profile, but only write to their own.\n    match /users/{userId} {\n      allow read, create;\n      allow update: if request.auth.uid == userId;\n\n      // A user can manage their own friends list.\n      // Another user can write to this list ONLY when accepting a friend request.\n      match /friends/{friendId} {\n        allow read, delete: if request.auth.uid == userId;\n        allow create: if request.auth.uid == userId || \n                       // Allow user B to write to user A's friend list if...\n                       // 1. user B is the one making the request (the one accepting)\n                       // 2. a friend request document exists from user A to user B\n                       (request.auth.uid == friendId &&\n                        exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)));\n      }\n    }\n\n    // Friend requests can be created by any authenticated user.\n    // They can only be read by the sender or receiver.\n    // They can only be deleted by the sender (cancel) or receiver (accept/reject).\n    match /friendRequests/{requestId} {\n      allow create: if request.auth.uid != null;\n      allow read, delete: if request.auth.uid == resource.data.to || request.auth.uid == resource.data.from;\n    }\n    \n    // Rules for chat rooms and messages\n    match /rooms/{roomId} {\n      // Allow read/write access to a room if the user is a participant\n      allow read, update: if request.auth.uid in resource.data.participants;\n      allow create: if request.auth.uid != null;\n\n      match /messages/{messageId} {\n        // Allow users to read messages in rooms they are part of\n        allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n        // Allow users to write messages only if they are the sender\n        allow create: if request.auth.uid == request.resource.data.userId;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:14:42.516Z] Jul 24, 2025 8:14:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:14:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:14:42.623Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:14:42.629Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":32,"currentOffset":889,"endOffset":898},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":42,"currentOffset":899,"endOffset":899},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":43,"currentOffset":900,"endOffset":900},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":54,"currentOffset":911,"endOffset":920},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":79,"currentOffset":936,"endOffset":936},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":80,"currentOffset":937,"endOffset":937},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":89,"currentOffset":946,"endOffset":947},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":89,"currentOffset":946,"endOffset":947},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:32 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:42 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:43 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:54 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:79 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:80 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:89 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:21:89 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:19:09.291Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:19:09.291Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Users can read anyone's profile, but only write to their own.\n    match /users/{userId} {\n      allow read, create: if request.auth != null;\n      allow update, delete: if request.auth.uid == userId;\n\n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        // A user can only read or delete their own friends.\n        allow read, delete: if request.auth.uid == userId;\n        \n        // A user can only be added to another user's friend list\n        // if a corresponding friend request exists and the request is being accepted by the recipient.\n        allow create: if request.auth.uid == friendId &&\n                       exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId));\n      }\n    }\n\n    // Rules for friend requests\n    match /friendRequests/{requestId} {\n      // A request can only be read by the sender or the receiver.\n      allow read: if request.auth != null && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      \n      // A request can only be created by the sender, and the requestId must match the sender_receiver format.\n      allow create: if request.auth.uid == request.resource.data.from && requestId == request.resource.data.from + '_' + request.resource.data.to;\n      \n      // A request can only be deleted by the sender (to cancel) or the receiver (to reject/accept).\n      allow delete: if request.auth != null && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n\n    // Rules for chat rooms and messages\n    match /rooms/{roomId} {\n      allow read, create: if request.auth != null && request.auth.uid in resource.data.participants;\n      \n      match /messages/{messageId} {\n        allow read, create: if request.auth != null && exists(/databases/$(database)/documents/rooms/$(roomId)) && request.auth.uid in get(/databases/$(database)/documents/rooms/$(roomId)).data.participants;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:19:09.316Z] Jul 24, 2025 8:19:09 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:19:09 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:19:09.392Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:19:09.394Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":20,"column":31,"currentOffset":771,"endOffset":780},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":41,"currentOffset":781,"endOffset":781},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":42,"currentOffset":782,"endOffset":782},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":53,"currentOffset":793,"endOffset":802},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":78,"currentOffset":818,"endOffset":818},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":79,"currentOffset":819,"endOffset":819},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":88,"currentOffset":828,"endOffset":829},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:20:31 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:41 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:42 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:53 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:78 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:79 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:88 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:22:04.956Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:22:04.956Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Users can only read and write to their own user document.\n    // They can read other users' documents but not write to them.\n    match /users/{userId} {\n      allow read;\n      allow create, update, delete: if request.auth != null && request.auth.uid == userId;\n\n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        // Anyone can read a user's friend list. Adjust if you want more privacy.\n        allow read: if request.auth != null;\n        \n        // Allow creating a friend document ONLY IF:\n        // 1. The request is authenticated.\n        // 2. The user is adding a friend to their OWN friends list (`userId == request.auth.uid`).\n        // 3. AND there is a corresponding accepted friend request.\n        allow create: if request.auth != null && (\n          (request.auth.uid == userId && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId))) ||\n          (request.auth.uid == friendId && exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)))\n        );\n\n        // Allow deleting a friend (unfriending)\n        allow delete: if request.auth != null && (request.auth.uid == userId || request.auth.uid == friendId);\n      }\n    }\n\n    // Rules for friend requests\n    match /friendRequests/{requestId} {\n      // A request ID is formatted as \"fromUid_toUid\"\n      function getFromUid() {\n        return requestId.split('_')[0];\n      }\n      function getToUid() {\n        return requestId.split('_')[1];\n      }\n\n      // Allow reading a request if you are the sender or receiver\n      allow read: if request.auth != null && (request.auth.uid == getFromUid() || request.auth.uid == getToUid());\n      \n      // Allow creating a request if you are the sender\n      allow create: if request.auth != null && request.auth.uid == getFromUid();\n      \n      // Allow deleting a request (rejecting/canceling) if you are the sender or receiver\n      allow delete: if request.auth != null && (request.auth.uid == getFromUid() || request.auth.uid == getToUid());\n    }\n    \n    // Rules for chat rooms and messages\n    match /rooms/{roomId} {\n      allow read, write: if request.auth != null && (resource == null || resource.data.participants.hasAny([request.auth.uid]));\n      \n      match /messages/{messageId} {\n        allow read, create: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n        allow update, delete: if request.auth != null && request.auth.uid == resource.data.userId;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:22:04.970Z] Jul 24, 2025 8:22:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:22:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:22:05.087Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:22:05.090Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":23,"column":49,"currentOffset":947,"endOffset":956},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":59,"currentOffset":957,"endOffset":957},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":60,"currentOffset":958,"endOffset":958},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":71,"currentOffset":969,"endOffset":978},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":96,"currentOffset":994,"endOffset":994},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":97,"currentOffset":995,"endOffset":995},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":108,"currentOffset":1006,"endOffset":1007},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":108,"currentOffset":1006,"endOffset":1007},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":51,"currentOffset":1072,"endOffset":1081},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":61,"currentOffset":1082,"endOffset":1082},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":62,"currentOffset":1083,"endOffset":1083},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":73,"currentOffset":1094,"endOffset":1103},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":98,"currentOffset":1119,"endOffset":1119},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":99,"currentOffset":1120,"endOffset":1120},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:23:49 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:59 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:60 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:23:71 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:96 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:97 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:23:108 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:23:108 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:24:51 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:24:61 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:24:62 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:24:73 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:24:98 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:24:99 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:26:15.116Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:26:15.116Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Users can be read by anyone signed in, but only created/updated by the user themselves.\n    match /users/{userId} {\n      allow read: if isSignedIn();\n      allow create, update: if isUser(userId);\n\n      // Friends subcollection rules\n      match /friends/{friendId} {\n        allow read: if isUser(userId);\n        // Writes to friends list are handled by the acceptFriendRequest logic below\n        allow create, delete: if \n          // Allow creating a friend if accepting a request from them\n          (request.resource.data.since == request.time && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId))) ||\n          // Allow creating a friend if they are accepting a request from you\n          (request.resource.data.since == request.time && exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId))) ||\n          // Allow deleting a friend record (removing a friend)\n          (isUser(userId));\n      }\n    }\n\n    // Friend requests\n    match /friendRequests/{requestId} {\n      // Allow read if user is sender or receiver\n      allow read: if isSignedIn() && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n      // Allow create if the user is the sender and the requestId is correct\n      allow create: if isUser(request.resource.data.from) && requestId == request.resource.data.from + '_' + request.resource.data.to;\n      // Allow delete if user is the sender (cancel) or receiver (reject/accept)\n      allow delete: if isSignedIn() && (isUser(resource.data.from) || isUser(resource.data.to));\n    }\n    \n    // Chat rooms\n    match /rooms/{roomId} {\n       allow read, create: if isSignedIn() && request.auth.uid in resource.data.participants;\n       \n       // Messages in a room\n       match /messages/{messageId} {\n         allow read, create: if isSignedIn() && request.auth.uid in get(/databases/$(database)/documents/rooms/$(roomId)).data.participants;\n       }\n    }\n  }\n}"}]}}
[debug] [2025-07-24T20:26:15.130Z] Jul 24, 2025 8:26:15 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:26:15 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:26:15.216Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:26:15.216Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":26,"column":66,"currentOffset":849,"endOffset":858},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":26,"column":76,"currentOffset":859,"endOffset":859},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":26,"column":77,"currentOffset":860,"endOffset":860},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":26,"column":88,"currentOffset":871,"endOffset":880},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":26,"column":113,"currentOffset":896,"endOffset":896},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":26,"column":114,"currentOffset":897,"endOffset":897},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":26,"column":125,"currentOffset":908,"endOffset":909},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":66,"currentOffset":1067,"endOffset":1076},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":76,"currentOffset":1077,"endOffset":1077},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":77,"currentOffset":1078,"endOffset":1078},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":88,"currentOffset":1089,"endOffset":1098},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":113,"currentOffset":1114,"endOffset":1114},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":114,"currentOffset":1115,"endOffset":1115},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:26:66 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:26:76 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:26:77 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:26:88 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:26:113 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:26:114 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:26:125 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:28:66 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:28:76 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:28:77 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:28:88 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:28:113 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:28:114 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:36:11.358Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:36:11.366Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read/write their own user document.\n    // Users can read other users' documents.\n    match /users/{userId} {\n      allow read, update, delete: if request.auth.uid == userId;\n      allow create: if request.auth.uid == userId;\n      allow get: if request.auth != null;\n\n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        allow read: if request.auth.uid == userId;\n        allow write, delete: if \n          // Allow adding a friend ONLY if a corresponding friend request exists\n          // and the current user is the one accepting the request.\n          (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) && get(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)).data.to == request.auth.uid) ||\n          (exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)) && get(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)).data.to == request.auth.uid) ||\n          // Allow the user to remove a friend from their own list\n          (request.auth.uid == userId && !request.resource.data.keys().hasAny(['since']));\n      }\n    }\n\n    // Rules for the 'rooms' collection and 'messages' subcollection\n    match /rooms/{roomId} {\n      // Allow read/write access to a room only if the user is a participant.\n      allow read, write: if request.auth.uid in resource.data.participants;\n\n      match /messages/{messageId} {\n        // Allow users to read messages in rooms they are part of.\n        allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n        // Allow users to create messages if they are a participant and the message is from them.\n        allow create: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]) && request.resource.data.userId == request.auth.uid;\n      }\n    }\n\n    // Rules for 'friendRequests' collection\n    match /friendRequests/{requestId} {\n        // Allow creating a request if the sender is the authenticated user.\n        allow create: if request.auth.uid == request.resource.data.from;\n        \n        // Allow reading a request if the user is the sender or the receiver.\n        allow read: if request.auth.uid == resource.data.from || request.auth.uid == resource.data.to;\n        \n        // Allow deleting a request (rejecting/canceling) if the user is the receiver or the sender.\n        allow delete: if request.auth.uid == resource.data.to || request.auth.uid == resource.data.from;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:36:11.383Z] Jul 24, 2025 8:36:11 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:36:11 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:36:11.563Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:36:11.563Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":20,"column":19,"currentOffset":710,"endOffset":719},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":29,"currentOffset":720,"endOffset":720},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":30,"currentOffset":721,"endOffset":721},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":41,"currentOffset":732,"endOffset":741},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":66,"currentOffset":757,"endOffset":757},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":67,"currentOffset":758,"endOffset":758},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":78,"currentOffset":769,"endOffset":770},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":97,"currentOffset":788,"endOffset":797},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":107,"currentOffset":798,"endOffset":798},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":108,"currentOffset":799,"endOffset":799},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":119,"currentOffset":810,"endOffset":819},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":144,"currentOffset":835,"endOffset":835},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":20,"column":145,"currentOffset":836,"endOffset":836},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":19,"currentOffset":909,"endOffset":918},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":29,"currentOffset":919,"endOffset":919},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":30,"currentOffset":920,"endOffset":920},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":41,"currentOffset":931,"endOffset":940},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":66,"currentOffset":956,"endOffset":956},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":67,"currentOffset":957,"endOffset":957},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":97,"currentOffset":987,"endOffset":996},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":107,"currentOffset":997,"endOffset":997},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":108,"currentOffset":998,"endOffset":998},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":119,"currentOffset":1009,"endOffset":1018},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":144,"currentOffset":1034,"endOffset":1034},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":145,"currentOffset":1035,"endOffset":1035},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:20:19 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:29 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:30 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:41 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:66 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:67 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:78 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:20:97 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:107 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:108 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:20:119 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:20:144 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:20:145 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:19 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:29 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:30 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:41 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:66 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:67 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:97 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:107 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:108 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:119 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:144 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:145 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:40:33.273Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:40:33.282Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    // USERS\n    // Users can read anyone's profile.\n    // Users can only create and update their own profile.\n    match /users/{userId} {\n      allow read: if isSignedIn();\n      allow create, update: if isSignedIn() && request.auth.uid == userId;\n    }\n\n    // FRIENDS\n    // Users can read their own friends list.\n    // Writing to a friends list is only allowed as part of accepting a friend request.\n    match /users/{userId}/friends/{friendId} {\n        allow read: if isSignedIn() && request.auth.uid == userId;\n        // Allow write only if the user is accepting a valid friend request from the other user.\n        // This is the key rule that allows acceptFriendRequest to work.\n        allow write: if isSignedIn() && (\n                      (request.auth.uid == userId && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId))) ||\n                      (request.auth.uid == friendId && exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)))\n                    );\n        allow delete: if isSignedIn() && (request.auth.uid == userId || request.auth.uid == friendId);\n    }\n    \n    // FRIEND REQUESTS\n    // A user can create a request.\n    // A user can read a request if they are the sender or receiver.\n    // A user can delete a request only if they are the receiver (accept/reject).\n    match /friendRequests/{requestId} {\n      allow read: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from;\n      allow delete: if isSignedIn() && request.auth.uid == resource.data.to;\n    }\n\n    // ROOMS (CHATS)\n    // Users can read a room if they are a participant.\n    // Users can create a room.\n    match /rooms/{roomId} {\n      allow read: if isSignedIn() && request.auth.uid in resource.data.participants;\n      allow create: if isSignedIn();\n      // No updates or deletes for simplicity.\n    }\n\n    // MESSAGES\n    // Users can read messages in a room they are a participant of.\n    // Users can write messages to a room they are a participant of.\n    match /rooms/{roomId}/messages/{messageId} {\n       allow read: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n       allow create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:40:33.305Z] Jul 24, 2025 8:40:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:40:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:40:33.444Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:40:33.447Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":28,"column":61,"currentOffset":978,"endOffset":987},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":71,"currentOffset":988,"endOffset":988},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":72,"currentOffset":989,"endOffset":989},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":83,"currentOffset":1000,"endOffset":1009},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":108,"currentOffset":1025,"endOffset":1025},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":109,"currentOffset":1026,"endOffset":1026},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":120,"currentOffset":1037,"endOffset":1038},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":120,"currentOffset":1037,"endOffset":1038},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":29,"column":63,"currentOffset":1115,"endOffset":1124},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":29,"column":73,"currentOffset":1125,"endOffset":1125},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":29,"column":74,"currentOffset":1126,"endOffset":1126},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":29,"column":85,"currentOffset":1137,"endOffset":1146},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":29,"column":110,"currentOffset":1162,"endOffset":1162},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":29,"column":111,"currentOffset":1163,"endOffset":1163},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:28:61 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:28:71 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:28:72 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:28:83 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:28:108 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:28:109 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:28:120 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:28:120 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:29:63 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:29:73 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:29:74 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:29:85 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:29:110 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:29:111 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:41:53.785Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:41:53.790Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    // Users can read anyone's profile, but only write to their own.\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth.uid == userId;\n    }\n\n    // A user can only read their own friends list.\n    // A friend can be added only if there was a pending friend request.\n    match /users/{userId}/friends/{friendId} {\n        allow read: if request.auth.uid == userId;\n\n        // Allow creating a friend document if a request exists and is being accepted by the recipient.\n        allow create: if \n          request.auth.uid == userId &&\n          exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) &&\n          get(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)).data.to == userId;\n\n        // Allow being added as a friend if a request exists and is being accepted by you.\n        allow create: if \n          request.auth.uid == friendId &&\n          exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)) &&\n          get(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)).data.to == friendId;\n          \n        // Allow deleting (removing) a friend\n        allow delete: if request.auth.uid == userId || request.auth.uid == friendId;\n    }\n\n    // Friend requests can be created by anyone.\n    // They can be read by the sender or receiver.\n    // They can only be deleted by the receiver (accept/reject).\n    match /friendRequests/{requestId} {\n      allow create: if request.auth.uid == request.resource.data.from;\n      allow read: if request.auth.uid == resource.data.from || request.auth.uid == resource.data.to;\n      allow delete: if request.auth.uid == resource.data.to;\n    }\n    \n    // Anyone authenticated can read room info.\n    // Only the creator can delete a room.\n    match /rooms/{roomId} {\n        allow read: if request.auth != null;\n        allow create: if request.auth.uid != null;\n        allow update: if request.auth.uid != null;\n    }\n    \n    // Anyone in a room (participant) can read messages.\n    // Only the sender can create a message.\n    match /rooms/{roomId}/messages/{messageId} {\n        allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n        allow create: if request.auth.uid == request.resource.data.userId;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:41:53.802Z] Jul 24, 2025 8:41:53 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:41:53 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:41:53.974Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:41:53.980Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":18,"currentOffset":702,"endOffset":711},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":28,"currentOffset":712,"endOffset":712},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":29,"currentOffset":713,"endOffset":713},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":40,"currentOffset":724,"endOffset":733},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":65,"currentOffset":749,"endOffset":749},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":66,"currentOffset":750,"endOffset":750},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":77,"currentOffset":761,"endOffset":762},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":15,"currentOffset":790,"endOffset":799},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":25,"currentOffset":800,"endOffset":800},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":26,"currentOffset":801,"endOffset":801},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":37,"currentOffset":812,"endOffset":821},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":62,"currentOffset":837,"endOffset":837},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":63,"currentOffset":838,"endOffset":838},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":18,"currentOffset":1057,"endOffset":1066},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":28,"currentOffset":1067,"endOffset":1067},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":29,"currentOffset":1068,"endOffset":1068},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":40,"currentOffset":1079,"endOffset":1088},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":65,"currentOffset":1104,"endOffset":1104},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":66,"currentOffset":1105,"endOffset":1105},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":27,"column":75,"currentOffset":1114,"endOffset":1115},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":15,"currentOffset":1145,"endOffset":1154},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":25,"currentOffset":1155,"endOffset":1155},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":26,"currentOffset":1156,"endOffset":1156},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":37,"currentOffset":1167,"endOffset":1176},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":62,"currentOffset":1192,"endOffset":1192},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":28,"column":63,"currentOffset":1193,"endOffset":1193},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:18 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:28 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:29 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:40 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:65 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:66 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:77 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:22:15 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:25 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:26 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:22:37 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:62 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:63 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:27:18 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:27:28 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:27:29 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:27:40 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:27:65 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:27:66 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:27:75 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:28:15 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:28:25 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:28:26 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:28:37 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:28:62 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:28:63 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:42:51.095Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:42:51.096Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    // Rules for user profile documents\n    match /users/{userId} {\n      // Any authenticated user can read any user's profile\n      allow read; \n      // Only the user themselves can create or update their own profile\n      allow create, update: if request.auth.uid == userId;\n\n      // Rules for the 'friends' subcollection within a user's document\n      match /friends/{friendId} {\n        // A user can only read their own friends list\n        allow read: if request.auth.uid == userId;\n        // A user can only delete friends from their own list\n        allow delete: if request.auth.uid == userId;\n        \n        // CRITICAL RULE FOR ACCEPTING FRIEND REQUESTS:\n        // A user can be added to another user's friend list IF AND ONLY IF:\n        // 1. A friend request exists from the target user (`userId`) to the user making the change (`friendId`).\n        // 2. The user making the change (`friendId`, who is `request.auth.uid`) is the recipient of that request.\n        allow create: if request.auth.uid == friendId && \n                       exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId));\n      }\n    }\n\n    // Rules for friend request documents\n    match /friendRequests/{requestId} {\n       // A request can be read only by the sender or the receiver\n      allow read: if request.auth.uid == resource.data.from || request.auth.uid == resource.data.to;\n      \n      // A request can only be created if the sender is the currently authenticated user\n      // and the request ID matches the expected format.\n      allow create: if request.auth.uid == request.resource.data.from &&\n                       requestId == request.resource.data.from + '_' + request.resource.data.to;\n\n      // A request can be deleted only by the receiver (rejecting/accepting) or the sender (canceling).\n      allow delete: if request.auth.uid == resource.data.to || request.auth.uid == resource.data.from;\n    }\n\n    // Rules for chat rooms and messages\n    match /rooms/{roomId} {\n      allow read, create: if request.auth.uid != null && resource.data.participants.hasAny([request.auth.uid]);\n      \n      match /messages/{messageId} {\n        allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n        allow create: if request.auth.uid == request.resource.data.userId;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:42:51.122Z] Jul 24, 2025 8:42:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:42:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:42:51.231Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:42:51.239Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":25,"column":31,"currentOffset":1159,"endOffset":1168},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":25,"column":41,"currentOffset":1169,"endOffset":1169},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":25,"column":42,"currentOffset":1170,"endOffset":1170},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":25,"column":53,"currentOffset":1181,"endOffset":1190},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":25,"column":78,"currentOffset":1206,"endOffset":1206},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":25,"column":79,"currentOffset":1207,"endOffset":1207},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":25,"column":88,"currentOffset":1216,"endOffset":1217},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:25:31 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:25:41 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:25:42 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:25:53 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:25:78 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:25:79 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:25:88 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:44:44.221Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:44:44.222Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check if a user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n\n    // Rules for the 'users' collection\n    match /users/{userId} {\n      // Any authenticated user can read public user profiles\n      allow get: if isAuthenticated();\n      // A user can only create or update their own profile\n      allow create, update: if isAuthenticated() && request.auth.uid == userId;\n\n      // Rules for the 'friends' subcollection within a user's document\n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if isAuthenticated() && request.auth.uid == userId;\n        // A user can remove a friend from their own list\n        allow delete: if isAuthenticated() && request.auth.uid == userId;\n        \n        // A user can be added to another user's friends list ONLY IF:\n        // 1. The person doing the adding is accepting a friend request.\n        // 2. A friend request from the target user (`userId`) to the authenticated user (`request.auth.uid`) exists.\n        allow create: if isAuthenticated() && (\n          // Scenario 1: The user is adding a friend to their OWN list.\n          // This happens when accepting a request from {friendId}.\n          (request.auth.uid == userId && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId))) ||\n          // Scenario 2: The system is adding the current user to the OTHER person's list.\n          // This happens when the current user accepts a request from {userId}.\n          (request.auth.uid == friendId && exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)))\n        );\n      }\n    }\n    \n    // Rules for the 'friendRequests' collection\n    match /friendRequests/{requestId} {\n      // A user can only interact with a friend request if their UID is part of the request ID.\n      // The request ID is formatted as 'fromUid_toUid'.\n      allow read, delete: if isAuthenticated() && (request.auth.uid in requestId.split('_'));\n      \n      // A user can only create a friend request if:\n      // 1. They are authenticated.\n      // 2. The 'from' field in the request matches their own UID.\n      // 3. The request document ID is correctly formatted as 'fromUid_toUid'.\n      allow create: if isAuthenticated() \n                    && request.resource.data.from == request.auth.uid\n                    && requestId == request.resource.data.from + '_' + request.resource.data.to;\n    }\n\n    // Rules for chat rooms\n    match /rooms/{roomId} {\n        // Allow read/write access to a room if the user is a participant.\n        // For DMs, the roomId is 'uid1_uid2', so this rule works implicitly.\n        allow read, update, delete: if isAuthenticated() && (\n                                    (resource.data.isDirectMessage == true && request.auth.uid in resource.data.participants) \n                                    || (resource.data.isDirectMessage != true) // Or if it's a public room\n                                  );\n        allow create: if isAuthenticated(); // Allow any authenticated user to create a room.\n\n        // Rules for messages within a room\n        match /messages/{messageId} {\n            allow read, create: if isAuthenticated() && (\n                                (get(/databases/$(database)/documents/rooms/$(roomId)).data.isDirectMessage == true && request.auth.uid in get(/databases/$(database)/documents/rooms/$(roomId)).data.participants)\n                                || (get(/databases/$(database)/documents/rooms/$(roomId)).data.isDirectMessage != true)\n                              );\n            // Users can only update/delete their own messages (future functionality)\n            allow update, delete: if isAuthenticated() && request.auth.uid == resource.data.userId;\n        }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:44:44.271Z] Jul 24, 2025 8:44:44 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:44:44 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:44:44.409Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:44:44.413Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":32,"column":49,"currentOffset":1403,"endOffset":1412},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":59,"currentOffset":1413,"endOffset":1413},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":60,"currentOffset":1414,"endOffset":1414},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":71,"currentOffset":1425,"endOffset":1434},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":96,"currentOffset":1450,"endOffset":1450},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":97,"currentOffset":1451,"endOffset":1451},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":108,"currentOffset":1462,"endOffset":1463},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":108,"currentOffset":1462,"endOffset":1463},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":51,"currentOffset":1700,"endOffset":1709},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":61,"currentOffset":1710,"endOffset":1710},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":62,"currentOffset":1711,"endOffset":1711},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":73,"currentOffset":1722,"endOffset":1731},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":98,"currentOffset":1747,"endOffset":1747},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":99,"currentOffset":1748,"endOffset":1748},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:32:49 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:59 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:60 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:71 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:96 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:97 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:108 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:32:108 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:35:51 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:35:61 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:35:62 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:35:73 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:35:98 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:35:99 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:48:04.550Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:48:04.550Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    // Users can read anyone's profile, but only write to their own.\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth.uid == userId;\n      \n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if request.auth.uid == userId;\n\n        // A user can remove a friend from their own list\n        allow delete: if request.auth.uid == userId;\n        \n        // Allow creating a friendship entry under two conditions:\n        // 1. The user is adding a friend to their OWN friends list.\n        // 2. The user is being added to another user's list AS PART OF accepting a friend request.\n        allow create: if (request.auth.uid == userId) || \n                       (get(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)).data.to == userId);\n      }\n    }\n    \n    // Rules for friend requests\n    match /friendRequests/{requestId} {\n      // Allow read if the user is either the sender or the receiver\n      allow read: if request.auth != null && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n      \n      // Allow creating a request if the 'from' field is the user's own UID\n      allow create: if request.auth.uid == request.resource.data.from;\n      \n      // Allow deleting a request if the user is either the sender (canceling) or receiver (rejecting)\n      allow delete: if request.auth.uid == resource.data.from || request.auth.uid == resource.data.to;\n    }\n    \n    // Rules for chat rooms\n    match /rooms/{roomId} {\n      // Allow read/write access to a room if the user is a participant.\n      allow read, write: if request.auth != null && resource.data.participants.hasAny([request.auth.uid]);\n      \n      // Rules for messages within a room\n      match /messages/{messageId} {\n        // Allow read if the user is a participant of the parent room.\n        allow read: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n        // Allow creating a message if the user is a participant and the message is from them.\n        allow create: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]) && request.resource.data.userId == request.auth.uid;\n        // Generally, message editing/deletion can be restricted.\n        allow update, delete: if false; \n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:48:04.582Z] Jul 24, 2025 8:48:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:48:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:48:04.684Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:48:04.694Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":24,"column":29,"currentOffset":916,"endOffset":925},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":39,"currentOffset":926,"endOffset":926},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":40,"currentOffset":927,"endOffset":927},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":51,"currentOffset":938,"endOffset":947},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":76,"currentOffset":963,"endOffset":963},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":77,"currentOffset":964,"endOffset":964},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":88,"currentOffset":975,"endOffset":976},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:24:29 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:24:39 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:24:40 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:24:51 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:24:76 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:24:77 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:24:88 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:49:36.143Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:49:36.152Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check if a user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n\n    // Rules for the 'users' collection\n    match /users/{userId} {\n      // Any authenticated user can create their own user document\n      allow create: if isAuthenticated() && request.auth.uid == userId;\n      // Any authenticated user can read any user's profile information\n      allow read: if isAuthenticated();\n      // A user can only update their own document\n      allow update: if isAuthenticated() && request.auth.uid == userId;\n      // Users cannot be deleted\n      allow delete: if false;\n\n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if isAuthenticated() && request.auth.uid == userId;\n\n        // Allow creating/deleting a friend relationship under specific conditions\n        allow write: if isAuthenticated() &&\n                     (\n                       // Case 1: Accepting a friend request\n                       // Allow adding a friend if a valid request exists where the current user is the recipient.\n                       // This allows the batch write in acceptFriendRequest to succeed.\n                       (request.auth.uid == userId && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId))) ||\n                       (request.auth.uid == friendId && exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId))) ||\n                       \n                       // Case 2: Removing a friend\n                       // Allow deleting the friend document if you are the owner (userId) or the friend (friendId)\n                       (request.auth.uid == userId || request.auth.uid == friendId)\n                     );\n      }\n    }\n\n    // Rules for the 'friendRequests' collection\n    match /friendRequests/{requestId} {\n      // Allow reading a request if you are the sender or the receiver\n      allow read: if isAuthenticated() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      // Allow creating a request if you are the sender\n      allow create: if isAuthenticated() && request.auth.uid == request.resource.data.from;\n      // Allow deleting a request if you are the sender (canceling) or the receiver (rejecting/accepting)\n      allow delete: if isAuthenticated() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      // Requests cannot be updated, only created and deleted\n      allow update: if false;\n    }\n    \n    // Rules for 'rooms' and 'messages'\n    match /rooms/{roomId} {\n      allow read, write: if isAuthenticated(); // More specific rules can be added here later if needed\n\n      match /messages/{messageId} {\n        allow read, create: if isAuthenticated();\n        allow update, delete: if isAuthenticated() && request.auth.uid == resource.data.userId;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:49:36.167Z] Jul 24, 2025 8:49:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:49:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:49:36.229Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:49:36.229Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":34,"column":62,"currentOffset":1413,"endOffset":1422},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":72,"currentOffset":1423,"endOffset":1423},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":73,"currentOffset":1424,"endOffset":1424},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":84,"currentOffset":1435,"endOffset":1444},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":109,"currentOffset":1460,"endOffset":1460},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":110,"currentOffset":1461,"endOffset":1461},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":121,"currentOffset":1472,"endOffset":1473},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":34,"column":121,"currentOffset":1472,"endOffset":1473},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":64,"currentOffset":1551,"endOffset":1560},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":74,"currentOffset":1561,"endOffset":1561},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":75,"currentOffset":1562,"endOffset":1562},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":86,"currentOffset":1573,"endOffset":1582},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":111,"currentOffset":1598,"endOffset":1598},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":35,"column":112,"currentOffset":1599,"endOffset":1599},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:34:62 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:34:72 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:34:73 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:34:84 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:34:109 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:34:110 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:34:121 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:34:121 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:35:64 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:35:74 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:35:75 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:35:86 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:35:111 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:35:112 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:52:37.728Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:52:37.728Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read their own profile, and other users can read public profiles\n    match /users/{userId} {\n      allow read;\n      allow create: if request.auth != null && request.auth.uid == userId;\n      allow update: if request.auth != null && request.auth.uid == userId;\n    }\n\n    // Users can read their own friends list\n    match /users/{userId}/friends/{friendId} {\n        allow read: if request.auth != null && request.auth.uid == userId;\n        // Allow creating/deleting a friend entry IF:\n        // 1. You are the user whose list is being modified.\n        // OR 2. A valid friend request exists that you are accepting.\n        allow write: if request.auth != null && (\n            (request.auth.uid == userId) || // The user is modifying their own friend list (e.g., removing a friend)\n            (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) && // The inverse request exists\n             get(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)).data.to == userId) // And it's directed to the current user\n        );\n    }\n    \n    // Friend Requests\n    match /friendRequests/{requestId} {\n      allow read: if request.auth != null && (\n        request.auth.uid == resource.data.from ||\n        request.auth.uid == resource.data.to\n      );\n      // Allow creating a request if you are the sender\n      allow create: if request.auth != null && request.auth.uid == request.resource.data.from;\n      // Allow deleting a request if you are the sender (canceling) or receiver (rejecting)\n      allow delete: if request.auth != null && (\n        request.auth.uid == resource.data.from ||\n        request.auth.uid == resource.data.to\n      );\n    }\n\n    // Chat Rooms\n    match /rooms/{roomId} {\n        // Allow read/write if the user is a participant in the room\n      allow read, write: if request.auth != null && request.auth.uid in resource.data.participants;\n    }\n\n    // Messages within a chat room\n    match /rooms/{roomId}/messages/{messageId} {\n      allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid]);\n      // Allow creating a message if the user is a participant of the room\n      // and the message is being sent by them.\n      allow create: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants.hasAny([request.auth.uid])\n                    && request.resource.data.userId == request.auth.uid;\n      allow update, delete: if resource.data.userId == request.auth.uid;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:52:37.740Z] Jul 24, 2025 8:52:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:52:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:52:37.835Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:52:37.836Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":40,"currentOffset":819,"endOffset":819},"description":"Unexpected ')'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":21,"currentOffset":917,"endOffset":926},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":31,"currentOffset":927,"endOffset":927},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":32,"currentOffset":928,"endOffset":928},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":43,"currentOffset":939,"endOffset":948},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":68,"currentOffset":964,"endOffset":964},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":69,"currentOffset":965,"endOffset":965},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":80,"currentOffset":976,"endOffset":977},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":18,"currentOffset":1038,"endOffset":1047},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":28,"currentOffset":1048,"endOffset":1048},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":29,"currentOffset":1049,"endOffset":1049},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":40,"currentOffset":1060,"endOffset":1069},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":65,"currentOffset":1085,"endOffset":1085},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":66,"currentOffset":1086,"endOffset":1086},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:40 - ERROR Unexpected ')'. 
[warn] ⚠  firestore.rules:22:21 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:31 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:32 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:22:43 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:68 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:69 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:22:80 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:23:18 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:28 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:29 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:23:40 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:65 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:66 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:54:40.130Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:54:40.130Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check if the user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n\n    // Helper function to check if the user is the owner of the document\n    function isOwner(userId) {\n      return request.auth.uid == userId;\n    }\n    \n    // USERS\n    // Users can read/write their own user document.\n    // Users can read other user's public profiles.\n    match /users/{userId} {\n      allow read: if isAuthenticated();\n      allow write: if isOwner(userId);\n      \n      // FRIENDS\n      // A user can read/write their own friends list.\n      // A user can be added to another user's friends list ONLY if a valid friend request exists.\n      match /friends/{friendId} {\n        allow read, write: if isOwner(userId);\n        allow create: if isAuthenticated() &&\n                      // Allow creating a friend document if the other user sent a request to you\n                      exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId));\n      }\n    }\n\n    // ROOMS\n    // Users can read/write rooms they are a participant of.\n    match /rooms/{roomId} {\n       allow read, create: if isAuthenticated() && resource.data.participants[request.auth.uid] == true;\n       allow update: if isAuthenticated() && request.auth.uid == resource.data.creatorId;\n\n       // MESSAGES\n       // Any participant of a room can read/write messages.\n       match /messages/{messageId} {\n         allow read, create: if isAuthenticated() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n       }\n    }\n\n    // FRIEND REQUESTS\n    // A user can create a request if the 'from' field matches their UID.\n    // A user can delete a request if the 'from' or 'to' field matches their UID.\n    match /friendRequests/{requestId} {\n      allow read, delete: if isAuthenticated() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      allow create: if isAuthenticated() && request.auth.uid == request.resource.data.from;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:54:40.144Z] Jul 24, 2025 8:54:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:54:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:54:40.303Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:54:40.304Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":31,"column":30,"currentOffset":1041,"endOffset":1050},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":31,"column":40,"currentOffset":1051,"endOffset":1051},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":31,"column":41,"currentOffset":1052,"endOffset":1052},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":31,"column":52,"currentOffset":1063,"endOffset":1072},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":31,"column":77,"currentOffset":1088,"endOffset":1088},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":31,"column":78,"currentOffset":1089,"endOffset":1089},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":31,"column":89,"currentOffset":1100,"endOffset":1101},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:31:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:31:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:31:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:31:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:31:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:31:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:31:89 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T20:55:59.636Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T20:55:59.640Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read/write their own user document.\n    // Users can read other user's public profiles.\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth.uid == userId;\n\n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        // A user can read and delete their own friends list.\n        allow read, delete: if request.auth.uid == userId;\n\n        // A user can add a friend to another user's list ONLY if\n        // there is a corresponding friend request that they are accepting.\n        allow create: if request.auth.uid == friendId &&\n                       exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)) &&\n                       get(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)).data.to == request.auth.uid;\n      }\n    }\n\n    // Rules for friend requests\n    match /friendRequests/{requestId} {\n      // Users can read requests sent to them.\n      allow read: if request.auth.uid == resource.data.to;\n      \n      // Users can create requests if they are the sender.\n      // The request ID must match the format 'fromUid_toUid'.\n      allow create: if request.auth.uid == request.resource.data.from &&\n                     requestId == request.resource.data.from + '_' + request.resource.data.to;\n      \n      // Users can delete requests they sent or requests sent to them.\n      allow delete: if request.auth.uid == resource.data.from || request.auth.uid == resource.data.to;\n    }\n    \n    // Rules for chat rooms and messages\n    match /rooms/{roomId} {\n      // Allow read/write access to a room only if the user is a participant.\n      allow read, write: if request.auth.uid in resource.data.participants;\n\n      match /messages/{messageId} {\n        // Allow read access to messages if the user is a participant of the room.\n        allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        \n        // Allow creating messages if the user is the sender and a participant of the room.\n        allow create: if request.auth.uid == request.resource.data.userId &&\n                       get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T20:55:59.651Z] Jul 24, 2025 8:55:59 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 8:55:59 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T20:55:59.725Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T20:55:59.726Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":31,"currentOffset":751,"endOffset":760},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":41,"currentOffset":761,"endOffset":761},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":42,"currentOffset":762,"endOffset":762},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":53,"currentOffset":773,"endOffset":782},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":78,"currentOffset":798,"endOffset":798},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":79,"currentOffset":799,"endOffset":799},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":88,"currentOffset":808,"endOffset":809},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":28,"currentOffset":852,"endOffset":861},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":38,"currentOffset":862,"endOffset":862},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":39,"currentOffset":863,"endOffset":863},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":50,"currentOffset":874,"endOffset":883},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":75,"currentOffset":899,"endOffset":899},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":76,"currentOffset":900,"endOffset":900},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:31 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:41 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:42 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:53 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:78 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:79 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:88 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:22:28 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:38 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:39 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:22:50 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:75 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:76 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:01:38.813Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:01:38.814Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read and write their own user document\n    match /users/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId;\n\n      // Anyone can read a user's public profile\n      allow get: if request.auth != null;\n\n      // A user's friends subcollection can only be read by the user\n      match /friends/{friendId} {\n        allow read, write: if request.auth != null && request.auth.uid == userId;\n      }\n    }\n\n    // Rules for chat rooms\n    match /rooms/{roomId} {\n      // Allow read/write access to room document for participants\n      allow read, write: if request.auth != null && resource.data.participants[request.auth.uid] == true;\n\n      // Rules for messages within a room\n      match /messages/{messageId} {\n        // Participants can read all messages\n        allow read: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        \n        // Only authenticated users who are participants can create messages\n        allow create: if request.auth != null && request.auth.uid == request.resource.data.userId &&\n                         get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      }\n    }\n\n    // Public read for all users\n     match /users/{userId} {\n       allow get: if request.auth != null;\n     }\n\n     // Deny all other friend-related writes to prevent bypasses\n    match /users/{userId}/friends/{friendId} {\n        allow write: if false; \n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:01:38.843Z] Jul 24, 2025 9:01:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:01:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:01:39.136Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:01:39.138Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:04:22.800Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:04:22.800Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth != null && request.auth.uid == userId;\n\n      match /friends/{friendId} {\n        allow read: if request.auth != null && request.auth.uid == userId;\n        // Allow creating/deleting a friend document IF\n        // 1. The user is authenticated.\n        // 2. A corresponding friend request exists which is being deleted in the same batch.\n        //    - The request must be TO the current user.\n        //    - This rule is for the RECEIVER of the friend request.\n        // 3. Or if the user is simply deleting a friend (the request no longer exists).\n        allow write: if request.auth != null &&\n                      ( (request.auth.uid == userId && \n                         existsAfter(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) == false) ||\n                        (request.auth.uid == friendId &&\n                         existsAfter(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)) == false) );\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      // A user can read a request if they are the sender or receiver\n      allow read: if request.auth != null && \n                  (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      \n      // A user can create a request if they are the sender\n      // and a request from the other user doesn't already exist.\n      allow create: if request.auth != null && \n                     request.auth.uid == request.resource.data.from &&\n                     !exists(/databases/$(database)/documents/friendRequests/$(request.resource.data.to)_$(request.resource.data.from));\n\n      // A user can delete a request if they are the sender (canceling) or receiver (rejecting)\n      allow delete: if request.auth != null &&\n                     (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n\n    match /rooms/{roomId} {\n      // Allow read/write if the user is a participant\n      allow read, write: if request.auth != null && request.auth.uid in resource.data.participants;\n      \n      // Allow create if the user is creating it and is a participant\n      allow create: if request.auth != null && request.auth.uid in request.resource.data.participants;\n\n      match /messages/{messageId} {\n        // Inherit read/write from parent room, but also check on create\n        allow read, write: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        \n        allow create: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:04:22.861Z] Jul 24, 2025 9:04:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:04:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:04:22.876Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:04:22.883Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth != null && request.auth.uid == userId;\n\n      match /friends/{friendId} {\n        allow read: if request.auth != null && request.auth.uid == userId;\n        // Allow creating/deleting a friend document IF\n        // 1. The user is authenticated.\n        // 2. A corresponding friend request exists which is being deleted in the same batch.\n        //    - The request must be TO the current user.\n        //    - This rule is for the RECEIVER of the friend request.\n        // 3. Or if the user is simply deleting a friend (the request no longer exists).\n        allow write: if request.auth != null &&\n                      ( (request.auth.uid == userId && \n                         existsAfter(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) == false) ||\n                        (request.auth.uid == friendId &&\n                         existsAfter(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)) == false) );\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      // A user can read a request if they are the sender or receiver\n      allow read: if request.auth != null && \n                  (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      \n      // A user can create a request if they are the sender\n      // and a request from the other user doesn't already exist.\n      allow create: if request.auth != null && \n                     request.auth.uid == request.resource.data.from &&\n                     !exists(/databases/$(database)/documents/friendRequests/$(request.resource.data.to)_$(request.resource.data.from));\n\n      // A user can delete a request if they are the sender (canceling) or receiver (rejecting)\n      allow delete: if request.auth != null &&\n                     (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n\n    match /rooms/{roomId} {\n      // Allow read/write if the user is a participant\n      allow read, write: if request.auth != null && request.auth.uid in resource.data.participants;\n      \n      // Allow create if the user is creating it and is a participant\n      allow create: if request.auth != null && request.auth.uid in request.resource.data.participants;\n\n      match /messages/{messageId} {\n        // Inherit read/write from parent room, but also check on create\n        allow read, write: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        \n        allow create: if request.auth != null && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:04:22.911Z] Jul 24, 2025 9:04:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:04:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:04:23.136Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:04:23.139Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":38,"currentOffset":896,"endOffset":905},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":48,"currentOffset":906,"endOffset":906},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":49,"currentOffset":907,"endOffset":907},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":60,"currentOffset":918,"endOffset":927},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":85,"currentOffset":943,"endOffset":943},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":86,"currentOffset":944,"endOffset":944},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":97,"currentOffset":955,"endOffset":956},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":97,"currentOffset":955,"endOffset":956},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":38,"currentOffset":1074,"endOffset":1083},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":48,"currentOffset":1084,"endOffset":1084},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":49,"currentOffset":1085,"endOffset":1085},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":60,"currentOffset":1096,"endOffset":1105},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":85,"currentOffset":1121,"endOffset":1121},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":86,"currentOffset":1122,"endOffset":1122},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":30,"currentOffset":1710,"endOffset":1719},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":40,"currentOffset":1720,"endOffset":1720},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":41,"currentOffset":1721,"endOffset":1721},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":52,"currentOffset":1732,"endOffset":1741},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":77,"currentOffset":1757,"endOffset":1757},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":78,"currentOffset":1758,"endOffset":1758},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":105,"currentOffset":1785,"endOffset":1786},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:38 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:48 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:49 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:60 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:85 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:86 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:97 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:21:97 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:23:38 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:48 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:49 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:23:60 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:85 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:86 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:36:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:36:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:36:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:36:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:36:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:36:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:36:105 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[debug] [2025-07-24T21:04:23.187Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:04:23.188Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":38,"currentOffset":896,"endOffset":905},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":48,"currentOffset":906,"endOffset":906},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":49,"currentOffset":907,"endOffset":907},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":60,"currentOffset":918,"endOffset":927},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":85,"currentOffset":943,"endOffset":943},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":86,"currentOffset":944,"endOffset":944},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":97,"currentOffset":955,"endOffset":956},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":97,"currentOffset":955,"endOffset":956},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":38,"currentOffset":1074,"endOffset":1083},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":48,"currentOffset":1084,"endOffset":1084},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":49,"currentOffset":1085,"endOffset":1085},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":60,"currentOffset":1096,"endOffset":1105},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":85,"currentOffset":1121,"endOffset":1121},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":86,"currentOffset":1122,"endOffset":1122},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":30,"currentOffset":1710,"endOffset":1719},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":40,"currentOffset":1720,"endOffset":1720},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":41,"currentOffset":1721,"endOffset":1721},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":52,"currentOffset":1732,"endOffset":1741},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":77,"currentOffset":1757,"endOffset":1757},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":78,"currentOffset":1758,"endOffset":1758},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":36,"column":105,"currentOffset":1785,"endOffset":1786},"description":"Unexpected '_$'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:38 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:48 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:49 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:60 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:85 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:86 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:97 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:21:97 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:23:38 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:48 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:49 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:23:60 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:23:85 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:23:86 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:36:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:36:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:36:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:36:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:36:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:36:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:36:105 - ERROR Unexpected '_$'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:10:59.231Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:10:59.231Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read public profiles of other users\n    // but can only write to their own user document.\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth != null && request.auth.uid == userId;\n\n      // A user can read their own friends list.\n      match /friends/{friendId} {\n        allow read: if request.auth != null && request.auth.uid == userId;\n        // Rules for writing to friends subcollection are handled below\n        allow write: if false; \n      }\n    }\n\n    // Friend requests can be read by sender or receiver.\n    // They can be created by the sender.\n    // They can only be deleted as part of the acceptFriendRequest batch.\n    match /friendRequests/{requestId} {\n      allow read: if request.auth != null && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n      allow create: if request.auth != null && request.resource.data.from == request.auth.uid;\n      allow delete: if false; // Deletion is handled by the batch write rule.\n    }\n    \n    // Batch write for accepting a friend request\n    // This allows a user to add a friend to their own list and the other user's list,\n    // and delete the request, but ONLY if a valid friend request exists.\n    match /users/{userId}/friends/{friendId} {\n      allow write: if request.auth != null && (\n        // Accepting a request sent TO me\n        (\n          request.auth.uid == userId && // I am modifying my own friends list\n          exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) && // The request from them to me exists\n          get(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)).data.to == userId // Double check 'to' field\n        ) ||\n        // The other user is accepting a request sent FROM me\n        (\n          request.auth.uid == friendId && // The other user is the one making the change\n          exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)) && // The request from me to them exists\n          get(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)).data.from == userId // Double check 'from' field\n        )\n      );\n    }\n    \n    // Anyone can remove a friend from their own list, and this will trigger\n    // the other user to be removed from their list via a function/batch on the client.\n    match /users/{userId}/friends/{friendId} {\n        allow delete: if request.auth != null && request.auth.uid == userId;\n    }\n\n    // Chat rooms and messages\n    match /rooms/{roomId} {\n      // Allow read/write if the user is a participant in a DM\n      allow read, write: if request.auth != null && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        // Allow read if user is a participant\n        allow read: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        // Allow create if user is a participant and the message is from them\n        allow create: if get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true && request.resource.data.userId == request.auth.uid;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:10:59.251Z] Jul 24, 2025 9:10:59 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:10:59 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:10:59.466Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:10:59.470Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":38,"column":18,"currentOffset":1600,"endOffset":1609},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":28,"currentOffset":1610,"endOffset":1610},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":29,"currentOffset":1611,"endOffset":1611},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":40,"currentOffset":1622,"endOffset":1631},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":65,"currentOffset":1647,"endOffset":1647},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":66,"currentOffset":1648,"endOffset":1648},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":77,"currentOffset":1659,"endOffset":1660},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":38,"column":77,"currentOffset":1659,"endOffset":1660},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":39,"column":15,"currentOffset":1726,"endOffset":1735},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":39,"column":25,"currentOffset":1736,"endOffset":1736},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":39,"column":26,"currentOffset":1737,"endOffset":1737},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":39,"column":37,"currentOffset":1748,"endOffset":1757},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":39,"column":62,"currentOffset":1773,"endOffset":1773},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":39,"column":63,"currentOffset":1774,"endOffset":1774},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":18,"currentOffset":2033,"endOffset":2042},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":28,"currentOffset":2043,"endOffset":2043},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":29,"currentOffset":2044,"endOffset":2044},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":40,"currentOffset":2055,"endOffset":2064},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":65,"currentOffset":2080,"endOffset":2080},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":66,"currentOffset":2081,"endOffset":2081},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":45,"column":15,"currentOffset":2159,"endOffset":2168},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":45,"column":25,"currentOffset":2169,"endOffset":2169},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":45,"column":26,"currentOffset":2170,"endOffset":2170},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":45,"column":37,"currentOffset":2181,"endOffset":2190},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":45,"column":62,"currentOffset":2206,"endOffset":2206},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":45,"column":63,"currentOffset":2207,"endOffset":2207},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:38:18 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:38:28 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:38:29 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:38:40 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:38:65 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:38:66 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:38:77 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:38:77 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:39:15 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:39:25 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:39:26 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:39:37 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:39:62 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:39:63 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:44:18 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:44:28 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:44:29 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:44:40 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:44:65 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:44:66 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:45:15 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:45:25 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:45:26 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:45:37 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:45:62 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:45:63 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:13:38.376Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:13:38.376Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"users\": {\n      // Allow all authenticated users to list and read user profiles\n      \".read\": \"auth != null\",\n      \"$uid\": {\n        // Allow a user to write only to their own document\n        \".write\": \"auth != null && auth.uid === $uid\",\n        \"friends\": {\n          // Allow reading own friends list\n          \".read\": \"auth != null && auth.uid === $uid\",\n           // Allow writing to a friends list (adding a friend)\n          \"$friendId\": {\n             \".write\": \"auth != null && (auth.uid === $uid || auth.uid === $friendId)\"\n          }\n        }\n      }\n    },\n    \"friendRequests\": {\n      \"$requestId\": {\n        // Allow reading if the user is the sender or receiver\n        \".read\": \"auth != null && (data.child('from').val() === auth.uid || data.child('to').val() === auth.uid)\",\n        // Allow writing only if creating a new request and the user is the sender\n        \".write\": \"auth != null && newData.child('from').val() === auth.uid && !data.exists()\",\n        \".validate\": \"newData.hasChildren(['from', 'to', 'createdAt'])\"\n      }\n    },\n    \"rooms\": {\n      \"$roomId\": {\n        // Allow read/write if the user is a participant\n        \".read\": \"auth != null && resource.data.participants[auth.uid] == true\",\n        \".write\": \"auth != null && resource.data.participants[auth.uid] == true\",\n        \"messages\": {\n           // Allow read/write if the user is a participant of the parent room\n          \".read\": \"get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true\",\n          \".write\": \"get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true\"\n        }\n      }\n    }\n  }\n}"}]}}
[debug] [2025-07-24T21:13:38.392Z] Jul 24, 2025 9:13:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:13:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:13:38.460Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:13:38.464Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:14:59.301Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:14:59.302Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Users can read the public profile of any user.\n    // Users can only write to their own profile.\n    match /users/{userId} {\n      allow read: if request.auth != null;\n      allow write: if request.auth != null && request.auth.uid == userId;\n\n      // A user can only read and write their own friends list.\n      match /friends/{friendId} {\n        allow read, write: if request.auth != null && request.auth.uid == userId;\n      }\n    }\n\n    // Friend requests can be created by the sender.\n    // They can be read by sender or receiver.\n    // They can be deleted by the receiver (as part of accepting/rejecting).\n    match /friendRequests/{requestId} {\n      allow read: if request.auth != null && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n      allow create: if request.auth != null && request.resource.data.from == request.auth.uid;\n      allow delete: if request.auth != null && resource.data.to == request.auth.uid;\n    }\n\n    // Chat rooms\n    match /rooms/{roomId} {\n      // Allow read if the user is a participant of a direct message\n      allow read: if request.auth != null && resource.data.participants[request.auth.uid] == true;\n      allow create: if request.auth != null;\n\n      // Messages\n      match /messages/{messageId} {\n        // Allow read if user can read the room.\n        // Allow write if user is a participant.\n        allow read: if get( /databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow create: if get( /databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:14:59.311Z] Jul 24, 2025 9:14:59 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:14:59 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:14:59.527Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:14:59.529Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:17:20.411Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:17:20.411Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /{document=**} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:17:20.432Z] Jul 24, 2025 9:17:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:17:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:17:20.492Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:17:20.492Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:19:11.249Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:19:11.249Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /users/{userId} {\n      // A user can read another user's public profile\n      allow get: if request.auth != null;\n      // A user can only write to their own profile\n      allow write: if request.auth != null && request.auth.uid == userId;\n\n      // Allow listing users for the \"find-friends\" page\n      allow list: if request.auth != null;\n      \n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if request.auth != null && request.auth.uid == userId;\n        // A user can be added to the friends list only if a corresponding friend request is being accepted.\n        // This rule allows the batch write in acceptFriendRequest to succeed.\n        allow write: if request.auth != null && \n                       (\n                         // Accepting a request sent TO me\n                         exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(request.auth.uid)) ||\n                         // My own write to my friends list when I accept a request\n                         (request.auth.uid == userId && exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)))\n                       );\n         // Allow deleting a friend (removing from the subcollection)\n         allow delete: if request.auth != null && (request.auth.uid == userId || request.auth.uid == friendId);\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      // A user can read a request if they are the sender or receiver\n      allow read: if request.auth != null && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n      // A user can create a request if they are the sender\n      allow create: if request.auth != null && request.resource.data.from == request.auth.uid;\n      // A user can delete a request if they are the sender (canceling) or receiver (rejecting/accepting)\n      allow delete: if request.auth != null && (resource.data.from == request.auth.uid || resource.data.to == request.auth.uid);\n    }\n\n    match /rooms/{roomId}/{document=**} {\n      allow read, write: if request.auth != null && (exists(/databases/$(database)/documents/rooms/$(roomId)) && resource.data.participants[request.auth.uid] == true);\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:19:11.278Z] Jul 24, 2025 9:19:11 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:19:11 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:19:11.332Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:19:11.333Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":22,"column":33,"currentOffset":961,"endOffset":970},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":43,"currentOffset":971,"endOffset":971},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":44,"currentOffset":972,"endOffset":972},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":55,"currentOffset":983,"endOffset":992},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":80,"currentOffset":1008,"endOffset":1008},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":81,"currentOffset":1009,"endOffset":1009},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":22,"column":92,"currentOffset":1020,"endOffset":1021},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":64,"currentOffset":1192,"endOffset":1201},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":74,"currentOffset":1202,"endOffset":1202},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":75,"currentOffset":1203,"endOffset":1203},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":86,"currentOffset":1214,"endOffset":1223},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":111,"currentOffset":1239,"endOffset":1239},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":24,"column":112,"currentOffset":1240,"endOffset":1240},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:22:33 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:43 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:44 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:22:55 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:22:80 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:22:81 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:22:92 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:24:64 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:24:74 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:24:75 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:24:86 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:24:111 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:24:112 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:21:12.273Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:21:12.274Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Rules for users collection\n    match /users/{userId} {\n      // Any signed-in user can read any user's public profile\n      allow read: if isSignedIn();\n      // Only the user themselves can write to their own document\n      allow write: if isUser(userId);\n\n      // Rules for friends subcollection\n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if isUser(userId);\n        // A user can be added to the friends list only by a function that handles a friend request.\n        // This rule allows the acceptFriendRequest batch write to succeed.\n        // It checks if a corresponding friend request exists, which will be deleted in the same batch.\n        allow write: if isSignedIn() &&\n                     (isUser(userId) || isUser(friendId)) &&\n                     (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) ||\n                      exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)));\n        // A user can remove a friend\n        allow delete: if isSignedIn() && (isUser(userId) || isUser(friendId));\n      }\n    }\n\n    // Rules for friendRequests collection\n    match /friendRequests/{requestId} {\n      // A request can be read by the sender or the receiver\n      allow read: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      // A request can be created only by the sender\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from;\n      // A request can be deleted by the sender (to cancel) or the receiver (to reject or accept)\n      allow delete: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n\n    // Rules for rooms and messages\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false; // Messages are immutable\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:21:12.294Z] Jul 24, 2025 9:21:12 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:21:12 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:21:12.377Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:21:12.380Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":32,"column":30,"currentOffset":1120,"endOffset":1129},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":40,"currentOffset":1130,"endOffset":1130},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":41,"currentOffset":1131,"endOffset":1131},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":52,"currentOffset":1142,"endOffset":1151},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":77,"currentOffset":1167,"endOffset":1167},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":78,"currentOffset":1168,"endOffset":1168},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":89,"currentOffset":1179,"endOffset":1180},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":30,"currentOffset":1223,"endOffset":1232},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":40,"currentOffset":1233,"endOffset":1233},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":41,"currentOffset":1234,"endOffset":1234},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":52,"currentOffset":1245,"endOffset":1254},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":77,"currentOffset":1270,"endOffset":1270},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":78,"currentOffset":1271,"endOffset":1271},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:32:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:89 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:33:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:33:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:33:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:33:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:33:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:33:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T21:56:35.558Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T21:56:35.558Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n    \n    match /users/{userId} {\n      allow read: if isSignedIn();\n      allow write: if isUser(userId);\n\n      match /friends/{friendId} {\n        allow read: if isUser(userId);\n        allow write: if isSignedIn() && (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) || exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)));\n        allow delete: if isSignedIn() && (isUser(userId) || isUser(friendId));\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      allow read: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from;\n      allow delete: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n    \n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false; \n      }\n    }\n\n    match /reels/{reelId} {\n      allow read: if isSignedIn();\n      // Allow create for signed in users for seeding purposes for now\n      allow create: if isSignedIn(); \n      allow update, delete: if false;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T21:56:35.603Z] Jul 24, 2025 9:56:35 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:56:35 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:56:35.692Z] Jul 24, 2025 9:56:35 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 9:56:35 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-24T21:56:35.877Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T21:56:35.878Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":21,"column":49,"currentOffset":483,"endOffset":492},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":59,"currentOffset":493,"endOffset":493},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":60,"currentOffset":494,"endOffset":494},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":71,"currentOffset":505,"endOffset":514},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":96,"currentOffset":530,"endOffset":530},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":97,"currentOffset":531,"endOffset":531},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":108,"currentOffset":542,"endOffset":543},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":130,"currentOffset":564,"endOffset":573},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":140,"currentOffset":574,"endOffset":574},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":141,"currentOffset":575,"endOffset":575},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":152,"currentOffset":586,"endOffset":595},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":177,"currentOffset":611,"endOffset":611},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":21,"column":178,"currentOffset":612,"endOffset":612},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:21:49 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:59 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:60 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:71 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:96 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:97 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:108 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:21:130 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:140 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:141 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:21:152 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:21:177 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:21:178 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T22:03:05.637Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T22:03:05.637Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /{document=**} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T22:03:05.660Z] Jul 24, 2025 10:03:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:03:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T22:03:05.763Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T22:03:05.764Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T22:04:25.017Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T22:04:25.018Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Rules for users collection\n    match /users/{userId} {\n      // Any signed-in user can read any user's public profile\n      allow read: if isSignedIn();\n      // Only the user themselves can write to their own document\n      allow write: if isUser(userId);\n\n      // Rules for friends subcollection\n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if isUser(userId);\n        // A user can be added to the friends list only by a function that handles a friend request.\n        // This rule allows the acceptFriendRequest batch write to succeed.\n        // It checks if a corresponding friend request exists, which will be deleted in the same batch.\n        allow write: if isSignedIn() &&\n                     (isUser(userId) || isUser(friendId)) &&\n                     (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) ||\n                      exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)));\n        // A user can remove a friend\n        allow delete: if isSignedIn() && (isUser(userId) || isUser(friendId));\n      }\n    }\n\n    // Rules for friendRequests collection\n    match /friendRequests/{requestId} {\n      // A request can be read by the sender or the receiver\n      allow read: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      // A request can be created only by the sender\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from;\n      // A request can be deleted by the sender (to cancel) or the receiver (to reject or accept)\n      allow delete: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n    \n    // Rules for reels collection\n    // Any signed-in user can read the reels\n    match /reels/{reelId} {\n        allow read: if isSignedIn();\n        allow write: if false; // Nobody can write directly, only through backend/functions\n    }\n\n    // Rules for rooms and messages\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false; // Messages are immutable\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T22:04:25.038Z] Jul 24, 2025 10:04:25 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:04:25 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T22:04:25.125Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T22:04:25.129Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":32,"column":30,"currentOffset":1120,"endOffset":1129},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":40,"currentOffset":1130,"endOffset":1130},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":41,"currentOffset":1131,"endOffset":1131},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":52,"currentOffset":1142,"endOffset":1151},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":77,"currentOffset":1167,"endOffset":1167},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":78,"currentOffset":1168,"endOffset":1168},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":89,"currentOffset":1179,"endOffset":1180},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":30,"currentOffset":1223,"endOffset":1232},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":40,"currentOffset":1233,"endOffset":1233},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":41,"currentOffset":1234,"endOffset":1234},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":52,"currentOffset":1245,"endOffset":1254},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":77,"currentOffset":1270,"endOffset":1270},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":78,"currentOffset":1271,"endOffset":1271},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:32:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:89 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:33:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:33:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:33:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:33:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:33:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:33:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-24T22:07:39.849Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-24T22:07:39.850Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Rules for users collection\n    match /users/{userId} {\n      // Any signed-in user can read any user's public profile\n      allow read: if isSignedIn();\n      // Only the user themselves can write to their own document\n      allow write: if isUser(userId);\n\n      // Rules for friends subcollection\n      match /friends/{friendId} {\n        // A user can read their own friends list\n        allow read: if isUser(userId);\n        // A user can be added to the friends list only by a function that handles a friend request.\n        // This rule allows the acceptFriendRequest batch write to succeed.\n        // It checks if a corresponding friend request exists, which will be deleted in the same batch.\n        allow write: if isSignedIn() &&\n                     (isUser(userId) || isUser(friendId)) &&\n                     (exists(/databases/$(database)/documents/friendRequests/$(friendId)_$(userId)) ||\n                      exists(/databases/$(database)/documents/friendRequests/$(userId)_$(friendId)));\n        // A user can remove a friend\n        allow delete: if isSignedIn() && (isUser(userId) || isUser(friendId));\n      }\n    }\n\n    // Rules for friendRequests collection\n    match /friendRequests/{requestId} {\n      // A request can be read by the sender or the receiver\n      allow read: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n      // A request can be created only by the sender\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from;\n      // A request can be deleted by the sender (to cancel) or the receiver (to reject or accept)\n      allow delete: if isSignedIn() && (request.auth.uid == resource.data.from || request.auth.uid == resource.data.to);\n    }\n    \n    // Rules for reels collection\n    match /reels/{reelId} {\n      // Any signed-in user can read reels\n      allow read: if isSignedIn();\n      // You might want to restrict write access later, e.g., only for admins or specific users\n      allow write: if isSignedIn(); \n    }\n\n    // Rules for rooms and messages\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false; // Messages are immutable\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-24T22:07:39.872Z] Jul 24, 2025 10:07:39 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:07:39 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T22:07:39.964Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-24T22:07:39.970Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":32,"column":30,"currentOffset":1120,"endOffset":1129},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":40,"currentOffset":1130,"endOffset":1130},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":41,"currentOffset":1131,"endOffset":1131},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":52,"currentOffset":1142,"endOffset":1151},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":77,"currentOffset":1167,"endOffset":1167},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":78,"currentOffset":1168,"endOffset":1168},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":32,"column":89,"currentOffset":1179,"endOffset":1180},"description":"Unexpected '_$'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":30,"currentOffset":1223,"endOffset":1232},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":40,"currentOffset":1233,"endOffset":1233},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":41,"currentOffset":1234,"endOffset":1234},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":52,"currentOffset":1245,"endOffset":1254},"description":"Missing 'match' keyword before path.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":77,"currentOffset":1270,"endOffset":1270},"description":"Forward slash '/' found where identifier or binding expected.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":33,"column":78,"currentOffset":1271,"endOffset":1271},"description":"mismatched input '$' expecting {'{', '/', PATH_SEGMENT}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:32:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:32:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:32:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:32:89 - ERROR Unexpected '_$'. 
[warn] ⚠  firestore.rules:33:30 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:33:40 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:33:41 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[warn] ⚠  firestore.rules:33:52 - ERROR Missing 'match' keyword before path. 
[warn] ⚠  firestore.rules:33:77 - ERROR Forward slash '/' found where identifier or binding expected. 
[warn] ⚠  firestore.rules:33:78 - ERROR mismatched input '$' expecting {'{', '/', PATH_SEGMENT} 
[info] ✔  firestore: Rules updated. 
[debug] [2025-07-24T22:52:46.084Z] Jul 24, 2025 10:52:46 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:52:46 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-24T22:52:46.395Z] Jul 24, 2025 10:52:46 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:52:46 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-24T22:52:48.151Z] Jul 24, 2025 10:52:48 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:52:48 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-24T22:52:48.334Z] Jul 24, 2025 10:52:48 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a403030052934293c1873f752528012e
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:52:48 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a403030052934293c1873f752528012e\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-24T22:52:52.443Z] Jul 24, 2025 10:52:52 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:52:52 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-24T22:53:26.181Z] Jul 24, 2025 10:53:26 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:53:26 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-24T22:53:47.426Z] Jul 24, 2025 10:53:47 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:53:47 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-24T22:53:47.728Z] Jul 24, 2025 10:53:47 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:53:47 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-24T22:53:47.987Z] Jul 24, 2025 10:53:47 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:53:47 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-24T22:53:48.026Z] Jul 24, 2025 10:53:48 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303057857603bf8dfe57df498a7c2
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:53:48 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303057857603bf8dfe57df498a7c2\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-24T22:56:49.970Z] Jul 24, 2025 10:56:49 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 24, 2025 10:56:49 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T01:46:38.293Z] Jul 25, 2025 1:46:38 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 25, 2025 1:46:38 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:46:38 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 25, 2025 1:46:38 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T06:30:58.919Z] ----------------------------------------------------------------------
[debug] [2025-07-25T06:30:58.925Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-25T06:30:58.927Z] CLI Version:   14.10.1
[debug] [2025-07-25T06:30:58.928Z] Platform:      linux
[debug] [2025-07-25T06:30:58.931Z] Node Version:  v20.19.1
[debug] [2025-07-25T06:30:58.931Z] Time:          Fri Jul 25 2025 06:30:58 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-25T06:30:58.932Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-25T06:31:01.102Z] openjdk version "21.0.7" 2025-04-15

[debug] [2025-07-25T06:31:01.103Z] OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-25T06:31:01.171Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-25T06:31:01.269Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-25T06:31:01.289Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-25T06:31:01.356Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-25T06:31:01.356Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-25T06:31:01.357Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-25T06:31:07.246Z] Jul 25, 2025 6:31:07 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:31:07 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-25T06:31:07.381Z] API endpoint: http://127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-25T06:31:07.617Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:18:06.579Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:18:06.580Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n\n    \"function isSignedIn()\": {\n      \"return\": \"request.auth != null;\"\n    },\n    \"function isUser(userId)\": {\n      \"return\": \"isSignedIn() && request.auth.uid == userId;\"\n    },\n\n    \"match\": \"/users/{userId}/{document=**}\",\n    \"allow\": \"read: if isSignedIn(); write: if isUser(userId);\",\n\n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow\": \"read, update, delete: if isSignedIn() && (request.resource.data.from.uid == request.auth.uid || request.resource.data.to.uid == request.auth.uid); create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid;\",\n    \n    \"match\": \"/rooms/{roomId}\",\n    \"allow\": \"read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n\n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow\": \"read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true; update, delete: if false;\"\n  }\n}\n"}]}}
[debug] [2025-07-25T12:18:06.719Z] Jul 25, 2025 12:18:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:18:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:18:07.836Z] Jul 25, 2025 12:18:07 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:18:07 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:18:08.953Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:18:08.954Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:22:23.157Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:22:23.157Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"rules_version\": \"2\",\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n    \"function isSignedIn()\": \"return request.auth != null;\",\n    \"function isUser(userId)\": \"return isSignedIn() && request.auth.uid == userId;\",\n    \"match\": \"/users/{userId}/{document=**}\",\n    \"allow\": \"read: if isSignedIn(); write: if isUser(userId);\",\n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow\": \"read, update, delete: if isSignedIn() && (request.resource.data.from.uid == request.auth.uid || request.resource.data.to.uid == request.auth.uid); create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid;\",\n    \"match\": \"/rooms/{roomId}\",\n    \"allow\": \"read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow\": \"read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true; update, delete: if false;\"\n  }\n}"}]}}
[debug] [2025-07-25T12:22:23.182Z] Jul 25, 2025 12:22:23 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:22:23 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:22:23.239Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:22:23.239Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:26:01.979Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:26:01.982Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isSignedIn() {\n      return request.auth != null;\n    }\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    match /users/{userId}/{document=**} {\n      allow read: if isSignedIn();\n      allow write: if isUser(userId);\n    }\n\n    match /friendRequests/{requestId} {\n      allow read, update, delete: if isSignedIn() && (request.resource.data.from.uid == request.auth.uid || request.resource.data.to.uid == request.auth.uid);\n      allow create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid;\n    }\n\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n    }\n\n    match /rooms/{roomId}/messages/{messageId} {\n      allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      allow update, delete: if false;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T12:26:02.001Z] Jul 25, 2025 12:26:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:26:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:26:03.974Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:26:03.974Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:28:05.784Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:28:05.784Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\n{\n  \"rules\": {\n    \"rules_version\": \"2\",\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n    \"function isSignedIn()\": \"return request.auth != null;\",\n    \"function isUser(userId)\": \"return isSignedIn() && request.auth.uid == userId;\",\n    \n    \"match\": \"/users/{userId}\",\n    \"allow\": \"read: if isSignedIn(); write: if isUser(userId);\",\n\n    \"match\": \"/users\",\n    \"allow\": \"list: if isSignedIn();\",\n\n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow\": \"create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid; read, update, delete: if isSignedIn() && (resource.data.from.uid == request.auth.uid || resource.data.to.uid == request.auth.uid);\",\n    \n    \"match\": \"/rooms/{roomId}\",\n    \"allow\": \"read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n    \n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow\": \"read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true; update, delete: if false;\"\n  }\n}\n"}]}}
[debug] [2025-07-25T12:28:05.798Z] Jul 25, 2025 12:28:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:28:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:28:05.854Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:28:05.854Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":2,"column":1,"currentOffset":1,"endOffset":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:2:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:31:29.883Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:31:29.886Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Rules for the 'users' collection\n    match /users/{userId} {\n      // Allow any signed-in user to list and read all user profiles for the 'find-friends' page.\n      // Allow a user to update only their own profile.\n      allow list, read: if isSignedIn();\n      allow update: if isUser(userId);\n      // Deny create and delete operations on user profiles for security.\n      allow create, delete: if false;\n\n      // Allow access to the 'friends' subcollection\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n        allow create, update, delete: if isUser(userId);\n      }\n    }\n\n    // Rules for the 'friendRequests' collection\n    match /friendRequests/{requestId} {\n      // Allow a request to be read, updated, or deleted only by the sender or the receiver.\n      allow read, update, delete: if isSignedIn() && (resource.data.from.uid == request.auth.uid || resource.data.to.uid == request.auth.uid);\n      // Allow a request to be created only by the user who is sending it.\n      allow create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid;\n    }\n\n    // Rules for chat rooms and messages\n    match /rooms/{roomId} {\n      // Allow read and write access only if the user is a participant in the room.\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        // Allow a user to read and create messages only if they are a participant of the room.\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        // Deny updates and deletes on messages to preserve chat history.\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T12:31:29.898Z] Jul 25, 2025 12:31:29 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:31:29 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:31:30.048Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:31:30.049Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:38:05.739Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:38:05.740Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n    \n    match /users/{userId} {\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n    }\n    \n    match /friendRequests/{requestId} {\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      allow read, update, delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\n    }\n    \n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n      \n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T12:38:05.754Z] Jul 25, 2025 12:38:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:38:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:38:05.929Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:38:05.934Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:44:02.342Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:44:02.342Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // USERS\n    // Allow signed-in users to list all users (for find-friends page).\n    // Allow users to read any profile.\n    // Allow users to only update their own profile.\n    match /users/{userId} {\n      allow list, read: if isSignedIn();\n      allow update: if isUser(userId);\n\n      // FRIENDS SUBCOLLECTION\n      // Allow users to only list and read their own friends.\n      match /friends/{friendId} {\n        allow list, read: if isUser(userId);\n      }\n    }\n\n    // FRIEND REQUESTS\n    // Allow creating a request if it's from the signed-in user.\n    // Allow reading/deleting a request if the user is the sender or receiver.\n    match /friendRequests/{requestId} {\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      allow read, delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\n    }\n    \n    // ROOMS\n    // Allow reading/writing to a room if the user is a participant.\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      // MESSAGES SUBCOLLECTION\n      // Allow reading/creating messages if the user is in the room.\n      // No updates or deletes allowed.\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T12:44:02.359Z] Jul 25, 2025 12:44:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:44:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:44:02.483Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:44:02.483Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:52:14.301Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:52:14.301Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isSignedIn() {\n      return request.auth != null;\n    }\n    \n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    match /users/{userId} {\n      // Allow signed-in users to read and list all user profiles for finding friends.\n      // Allow a user to only update their own profile.\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n\n      // Allow a user to read their own friends list.\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n      }\n    }\n    \n    match /friendRequests/{requestId} {\n      // Allow a user to create a request if they are the sender.\n      // Allow a user to read, update, or delete a request if they are the sender or receiver.\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      allow read, update, delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\n    }\n\n    match /rooms/{roomId} {\n      // Allow read and write access if the user is a participant in the room.\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        // Allow users to read and create messages in rooms they are a part of.\n        // Disallow updating or deleting messages.\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T12:52:14.315Z] Jul 25, 2025 12:52:14 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:52:14 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:52:14.423Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:52:14.426Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T12:59:21.760Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T12:59:21.763Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    function isSignedIn() {\n      return request.auth != null;\n    }\n    \n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    match /users/{userId} {\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n      }\n    }\n    \n    match /friendRequests/{requestId} {\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      allow read, update, delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\n    }\n    \n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T12:59:21.780Z] Jul 25, 2025 12:59:21 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 12:59:21 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T12:59:21.874Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T12:59:21.875Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:01:30.187Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:01:30.188Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n    \n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Rules for the 'users' collection\n    match /users/{userId} {\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n\n      // Rules for the 'friends' subcollection\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n      }\n    }\n\n    // Rules for the 'friendRequests' collection\n    match /friendRequests/{requestId} {\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      allow read, update, delete: if isSignedIn() && \n                                   (request.auth.uid == resource.data.from.uid || \n                                    request.auth.uid == resource.data.to.uid);\n    }\n    \n    // Rules for 'rooms' and 'messages'\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false; // Messages cannot be edited or deleted\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:01:30.195Z] Jul 25, 2025 1:01:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:01:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:01:30.271Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:01:30.275Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:06:33.429Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:06:33.429Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Allow signed-in users to list all users for the 'find-friends' page,\n    // and only allow users to update their own profile.\n    match /users/{userId} {\n      allow list, read: if isSignedIn();\n      allow update: if isUser(userId);\n      \n      // Allow users to list and read their own friends list.\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n      }\n    }\n\n    // Allow creating a request if the sender is the current user.\n    // Allow reading/deleting a request if the user is either the sender or receiver.\n    match /friendRequests/{requestId} {\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      allow read, update, delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\n    }\n\n    // Allow read/write to a room only if the user is a participant.\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      // Allow creating messages if the user is a participant of the room.\n      // Disallow updating/deleting messages.\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:06:33.442Z] Jul 25, 2025 1:06:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:06:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:06:33.568Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:06:33.569Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:08:38.654Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:08:38.655Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /{document=**} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:08:38.668Z] Jul 25, 2025 1:08:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:08:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:08:38.726Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:08:38.728Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:14:45.948Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:14:45.948Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"rules_version\": \"2\",\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n\n    \"function isSignedIn()\": \"return request.auth != null;\",\n    \"function isUser(userId)\": \"return isSignedIn() && request.auth.uid == userId;\",\n\n    \"match\": \"/users/{userId}\",\n    \"allow read, list: if isSignedIn();\",\n    \"allow update, write: if isUser(userId);\",\n\n    \"match\": \"/users/{userId}/friends/{friendId}\",\n    \"allow read, list: if isUser(userId);\",\n    \n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow read: if isSignedIn();\",\n    \"allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\",\n    \"allow delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\",\n\n    \"match\": \"/rooms/{roomId}\",\n    \"allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n\n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\",\n    \"allow update, delete: if false;\"\n  }\n}\n"}]}}
[debug] [2025-07-25T13:14:45.966Z] Jul 25, 2025 1:14:45 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:14:45 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:14:46.017Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:14:46.019Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:20:33.784Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:20:33.793Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"rules_version\": \"2\",\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n    \"function isSignedIn()\": \"return request.auth != null;\",\n    \"function isUser(userId)\": \"return isSignedIn() && request.auth.uid == userId;\",\n\n    \"match\": \"/users/{userId}\",\n    \"allow read, list\": \"if isSignedIn();\",\n    \"allow update\": \"if isUser(userId);\",\n\n    \"match\": \"/users/{userId}/friends/{friendId}\",\n    \"allow read, list\": \"if isUser(userId);\",\n\n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow read, delete\": \"if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\",\n    \"allow create\": \"if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\",\n\n    \"match\": \"/rooms/{roomId}\",\n    \"allow read, write\": \"if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n\n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow read, create\": \"if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\",\n    \"allow update, delete\": \"if false;\"\n  }\n}\n"}]}}
[debug] [2025-07-25T13:20:33.802Z] Jul 25, 2025 1:20:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:20:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:20:33.863Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:20:33.864Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:25:29.825Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:25:29.825Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"rules_version\": \"2\",\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n\n    \"function isSignedIn()\": \"return request.auth != null;\",\n    \"function isUser(userId)\": \"return isSignedIn() && request.auth.uid == userId;\",\n\n    \"match\": \"/users/{userId}\",\n    \"allow list, read\": \"if isSignedIn();\",\n    \"allow update\": \"if isUser(userId);\",\n\n    \"match\": \"/users/{userId}/friends/{friendId}\",\n    \"allow read, list\": \"if isUser(userId);\",\n\n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow read, delete\": \"if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\",\n    \"allow create\": \"if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\",\n\n    \"match\": \"/rooms/{roomId}\",\n    \"allow read, write\": \"if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n\n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow read, create\": \"if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\",\n    \"allow update, delete\": \"if false;\"\n  }\n}\n"}]}}
[debug] [2025-07-25T13:25:29.839Z] Jul 25, 2025 1:25:29 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:25:29 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:25:29.883Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:25:29.886Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:29:15.465Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:29:15.465Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"{\n  \"rules\": {\n    \"rules_version\": \"2\",\n    \"service\": \"cloud.firestore\",\n    \"match\": \"/databases/{database}/documents\",\n\n    \"function isSignedIn()\": \"return request.auth != null;\",\n    \"function isUser(userId)\": \"return isSignedIn() && request.auth.uid == userId;\",\n\n    \"match\": \"/users/{userId}\",\n    \"allow list, read\": \"if isSignedIn();\",\n    \"allow update\": \"if isUser(userId);\",\n\n    \"match\": \"/users/{userId}/friends/{friendId}\",\n    \"allow read, list\": \"if isUser(userId);\",\n\n    \"match\": \"/friendRequests/{requestId}\",\n    \"allow read, delete\": \"if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\",\n    \"allow create\": \"if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\",\n\n    \"match\": \"/rooms/{roomId}\",\n    \"allow read, write\": \"if isSignedIn() && resource.data.participants[request.auth.uid] == true;\",\n\n    \"match\": \"/rooms/{roomId}/messages/{messageId}\",\n    \"allow read, create\": \"if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\",\n    \"allow update, delete\": \"if false;\"\n  }\n}"}]}}
[debug] [2025-07-25T13:29:15.492Z] Jul 25, 2025 1:29:15 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:29:15 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:29:15.611Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:29:15.611Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":1,"column":1},"description":"mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:1:1 - ERROR mismatched input '{' expecting {'function', 'import', 'service', 'rules_version'} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:36:11.869Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:36:11.869Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Oturum açmış herhangi bir kullanıcının tüm belgelere erişmesine izin ver.\n    match /{document=**} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:36:11.880Z] Jul 25, 2025 1:36:11 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:36:11 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:36:11.949Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:36:11.950Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:37:31.185Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:37:31.185Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    match /users/{userId} {\n      // Allow any signed-in user to read and list user profiles (for find-friends page)\n      // Allow a user to only update their own profile\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n\n      // Allow a user to read their own friends list\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      // Allow any signed-in user to read requests (for checking if a request exists)\n      allow read: if isSignedIn();\n      // Allow creating a request only if the 'from' user is the one making the request\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.from.uid;\n      // Allow deleting a request if the user is the sender or receiver\n      allow delete: if isSignedIn() && (request.auth.uid == resource.data.from.uid || request.auth.uid == resource.data.to.uid);\n    }\n\n    match /rooms/{roomId} {\n      // Allow read, create, update if the user is a participant\n      allow read, create, update: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        // Allow read, create if the user is a participant of the room\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:37:31.203Z] Jul 25, 2025 1:37:31 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:37:31 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:37:31.308Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:37:31.309Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:44:12.972Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:44:12.972Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /{document=**} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:44:12.984Z] Jul 25, 2025 1:44:12 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:44:12 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:44:13.061Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:44:13.065Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T13:59:29.517Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T13:59:29.518Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper functions\n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    // Users collection\n    // Allow any signed-in user to read/list all users for finding friends.\n    // Allow a user to update only their own document.\n    match /users/{userId} {\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n      \n      // Friends subcollection\n      // Allow a user to read/list only their own friends.\n      match /friends/{friendId} {\n        allow read, list: if isUser(userId);\n        allow create, delete: if isUser(userId);\n      }\n    }\n    \n    // Friend Requests collection\n    // Allow read to check for existing requests.\n    // Allow create only if the request is from the signed-in user.\n    match /friendRequests/{requestId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid;\n      allow delete: if isSignedIn();\n    }\n    \n    // Rooms collection\n    // Allow read/write if the user is a participant in the room.\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      // Messages subcollection\n      // Allow read/create if the user is a participant in the room.\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false; // Messages cannot be edited or deleted\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T13:59:29.530Z] Jul 25, 2025 1:59:29 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 1:59:29 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T13:59:29.649Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T13:59:29.658Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T14:04:44.685Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T14:04:44.685Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    function isSignedIn() {\n      return request.auth != null;\n    }\n    \n    function isUser(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    match /users/{userId} {\n      allow read, list: if isSignedIn();\n      allow update: if isUser(userId);\n\n      match /friends/{friendId} {\n        allow read, list, create, delete: if isUser(userId);\n      }\n    }\n\n    match /friendRequests/{requestId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && request.resource.data.from.uid == request.auth.uid;\n      allow delete: if isSignedIn();\n    }\n\n    match /rooms/{roomId} {\n      allow read, write: if isSignedIn() && resource.data.participants[request.auth.uid] == true;\n\n      match /messages/{messageId} {\n        allow read, create: if isSignedIn() && get(/databases/$(database)/documents/rooms/$(roomId)).data.participants[request.auth.uid] == true;\n        allow update, delete: if false;\n      }\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T14:04:44.699Z] Jul 25, 2025 2:04:44 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 2:04:44 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T14:04:44.791Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T14:04:44.802Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T14:07:49.996Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T14:07:49.996Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /{document=**} {\n      allow read, write: if request.auth != null;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-25T14:07:50.013Z] Jul 25, 2025 2:07:50 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 2:07:50 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T14:07:50.077Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T14:07:50.077Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-25T14:09:40.981Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-25T14:09:40.981Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /{document=**} {\n      allow read, write: if true;\n    }\n  }\n}"}]}}
[debug] [2025-07-25T14:09:40.996Z] Jul 25, 2025 2:09:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 2:09:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T14:09:41.046Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-25T14:09:41.046Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[debug] [2025-07-25T17:19:59.863Z] ----------------------------------------------------------------------
[debug] [2025-07-25T17:19:59.876Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-25T17:19:59.880Z] CLI Version:   14.10.1
[debug] [2025-07-25T17:19:59.881Z] Platform:      linux
[debug] [2025-07-25T17:19:59.882Z] Node Version:  v20.19.1
[debug] [2025-07-25T17:19:59.882Z] Time:          Fri Jul 25 2025 17:19:59 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-25T17:19:59.884Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-25T17:20:02.307Z] openjdk version "21.0.7" 2025-04-15
OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-25T17:20:02.371Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-25T17:20:02.437Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-25T17:20:02.459Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-25T17:20:02.485Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-25T17:20:02.486Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-25T17:20:02.490Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-25T17:20:10.833Z] Jul 25, 2025 5:20:10 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 5:20:10 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-25T17:20:10.981Z] API endpoint: http://127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-25T17:20:11.252Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-07-25T18:30:30.325Z] Jul 25, 2025 6:30:30 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:30:30 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:30:30.834Z] Jul 25, 2025 6:30:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:30:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T18:30:31.337Z] Jul 25, 2025 6:30:31 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:30:31 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T18:30:31.393Z] Jul 25, 2025 6:30:31 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a4030354722beb7effd32e974e58d116
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:30:31 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a4030354722beb7effd32e974e58d116\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T18:30:33.818Z] Jul 25, 2025 6:30:33 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:30:33 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:36:55.832Z] Jul 25, 2025 6:36:55 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:36:55 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T18:37:14.617Z] Jul 25, 2025 6:37:14 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:37:14 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T18:37:14.669Z] Jul 25, 2025 6:37:14 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:37:14 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:37:14.924Z] Jul 25, 2025 6:37:14 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:37:14 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T18:37:15.004Z] Jul 25, 2025 6:37:14 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303fcd34449495156c8ce9d12ac93
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:37:14 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303fcd34449495156c8ce9d12ac93\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T18:37:16.267Z] Jul 25, 2025 6:37:16 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:37:16 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:40:09.283Z] Jul 25, 2025 6:40:09 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:40:09 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T18:40:27.613Z] Jul 25, 2025 6:40:27 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:40:27 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:40:27.645Z] Jul 25, 2025 6:40:27 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:40:27 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T18:40:27.725Z] Jul 25, 2025 6:40:27 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:40:27 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T18:40:27.738Z] Jul 25, 2025 6:40:27 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a403031fb207ef8240909fe364d127d5
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:40:27 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a403031fb207ef8240909fe364d127d5\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T18:40:29.196Z] Jul 25, 2025 6:40:29 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:40:29 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:42:44.035Z] Jul 25, 2025 6:42:44 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:42:44 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T18:42:45.845Z] Jul 25, 2025 6:42:45 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:42:45 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T18:42:46.131Z] Jul 25, 2025 6:42:46 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 6:42:46 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:02.716Z] Jul 25, 2025 7:15:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T19:15:03.025Z] Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:15:03.110Z] Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a4030375d31d97dc299844031f6fe543
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a4030375d31d97dc299844031f6fe543\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:15:03.364Z] Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:15:03.475Z] Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a403033b54f45d8145ec6ecb1150983e
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:03 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a403033b54f45d8145ec6ecb1150983e\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:15:04.488Z] Jul 25, 2025 7:15:04 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:04 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:05.011Z] Jul 25, 2025 7:15:05 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:05 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:22.672Z] Jul 25, 2025 7:15:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:23.058Z] Jul 25, 2025 7:15:23 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:23 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:30.231Z] Jul 25, 2025 7:15:30 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:30 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:30.235Z] Jul 25, 2025 7:15:30 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:30 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:31.086Z] Jul 25, 2025 7:15:31 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:31 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:31.443Z] Jul 25, 2025 7:15:31 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:31 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:32.102Z] Jul 25, 2025 7:15:32 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:32 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:15:38.409Z] Jul 25, 2025 7:15:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:15:38.485Z] Jul 25, 2025 7:15:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:15:38.545Z] Jul 25, 2025 7:15:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:15:59.103Z] Jul 25, 2025 7:15:59 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:59 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:15:59.114Z] Jul 25, 2025 7:15:59 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a4030336c3470ad8427758fc9ba48b96
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:59 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a4030336c3470ad8427758fc9ba48b96\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:15:59.451Z] Jul 25, 2025 7:15:59 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:15:59 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:16:01.377Z] Jul 25, 2025 7:16:01 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:16:01 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:17:00.692Z] Jul 25, 2025 7:17:00 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:17:00 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:17:36.621Z] Jul 25, 2025 7:17:36 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:17:36 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:17:36.634Z] Jul 25, 2025 7:17:36 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:17:36 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:17:36.674Z] Jul 25, 2025 7:17:36 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303bf59d5c1248464c7f1bcc5ada2
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:17:36 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303bf59d5c1248464c7f1bcc5ada2\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:17:36.748Z] Jul 25, 2025 7:17:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:17:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T19:17:38.473Z] Jul 25, 2025 7:17:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:17:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:20:36.440Z] Jul 25, 2025 7:20:36 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / 
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:20:36 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: Unexpected HTTP/1.x request: GET / \n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:315)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:20:36.496Z] Jul 25, 2025 7:20:36 PM io.grpc.netty.NettyServerTransport notifyTerminated
INFO: Transport failed
io.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303a0e0fd1c9a3c73e304f8e322fa
	at io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)
	at io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)
	at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:20:36 PM io.grpc.netty.NettyServerTransport notifyTerminated\nINFO: Transport failed\nio.netty.handler.codec.http2.Http2Exception: HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 16030105a8010005a40303a0e0fd1c9a3c73e304f8e322fa\n\tat io.netty.handler.codec.http2.Http2Exception.connectionError(Http2Exception.java:107)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.readClientPrefaceString(Http2ConnectionHandler.java:319)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$PrefaceDecoder.decode(Http2ConnectionHandler.java:245)\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:451)\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530)\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1407)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:918)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:994)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n"}}
[debug] [2025-07-25T19:20:36.611Z] Jul 25, 2025 7:20:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:20:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-25T19:20:37.102Z] Jul 25, 2025 7:20:37 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:20:37 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:20:56.382Z] Jul 25, 2025 7:20:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:20:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-07-25T19:24:56.010Z] Jul 25, 2025 7:24:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 25, 2025 7:24:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:24:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 25, 2025 7:24:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:27:22.133Z] Jul 25, 2025 7:27:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:27:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:54:06.337Z] Jul 25, 2025 7:54:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:54:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-25T19:54:06.465Z] Jul 25, 2025 7:54:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 25, 2025 7:54:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-26T00:39:02.578Z] Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-26T00:39:02.598Z] Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\nJul 26, 2025 12:39:02 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-07-26T07:44:51.003Z] ----------------------------------------------------------------------
[debug] [2025-07-26T07:44:51.010Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-26T07:44:51.013Z] CLI Version:   14.10.1
[debug] [2025-07-26T07:44:51.014Z] Platform:      linux
[debug] [2025-07-26T07:44:51.015Z] Node Version:  v20.19.1
[debug] [2025-07-26T07:44:51.015Z] Time:          Sat Jul 26 2025 07:44:51 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-26T07:44:51.016Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-26T07:44:51.024Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-07-26T07:44:53.375Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-07-26T07:44:53.378Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-07-26T07:44:54.099Z] openjdk version "21.0.7" 2025-04-15
OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-26T07:44:54.155Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-26T07:44:54.208Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-26T07:44:54.232Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-26T07:44:54.279Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-26T07:44:54.280Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-26T07:44:54.280Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-26T07:44:59.821Z] Jul 26, 2025 7:44:59 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 26, 2025 7:44:59 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-26T07:44:59.984Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-26T07:44:59.990Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-26T07:45:00.103Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-07-26T11:50:47.397Z] ----------------------------------------------------------------------
[debug] [2025-07-26T11:50:47.443Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-26T11:50:47.456Z] CLI Version:   14.10.1
[debug] [2025-07-26T11:50:47.471Z] Platform:      linux
[debug] [2025-07-26T11:50:47.471Z] Node Version:  v20.19.1
[debug] [2025-07-26T11:50:47.472Z] Time:          Sat Jul 26 2025 11:50:47 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-26T11:50:47.472Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-26T11:50:52.146Z] openjdk version "21.0.7" 2025-04-15
OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-26T11:50:52.234Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-26T11:50:52.379Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-26T11:50:52.477Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-26T11:50:52.547Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-26T11:50:52.548Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-26T11:50:52.554Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-26T11:50:58.796Z] Jul 26, 2025 11:50:58 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 26, 2025 11:50:58 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-26T11:50:58.914Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-26T11:50:58.914Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-26T11:50:59.050Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
